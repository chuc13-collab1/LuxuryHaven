<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒêƒÉng nh·∫≠p - LuxuryHavenTravel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="css/loading.css">
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js" type="module"></script>
    <script src="js/loading.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      height: 100vh;
      overflow: hidden;
    }
    
    .auth-container {
      display: flex;
      height: 100vh;
    }
    
    .auth-left {
      flex: 1;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 60px;
    }
    
    .auth-right {
      flex: 1;
      background: linear-gradient(45deg, rgba(26, 188, 156, 0.8), rgba(52, 152, 219, 0.8)), 
                  url('https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80') center/cover;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }
    
    .auth-form-container {
      width: 100%;
      max-width: 400px;
    }
    
    .auth-title {
      font-size: 2.5rem;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    .form-control {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 50px;
      font-size: 16px;
      background: #f8f9fa;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #1abc9c;
      background: white;
      box-shadow: 0 0 10px rgba(26, 188, 156, 0.1);
    }
    
    .form-control:invalid {
      border-color: #e74c3c;
    }
    
    .form-control:valid {
      border-color: #27ae60;
    }
    
    .form-control::placeholder {
      color: #95a5a6;
    }
    
    .btn-primary {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #1abc9c, #3498db);
      border: none;
      border-radius: 50px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(26, 188, 156, 0.3);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    .auth-switch {
      color: #1abc9c;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    
    .auth-switch:hover {
      color: #16a085;
      text-decoration: underline;
    }
    
    .social-buttons {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      justify-content: center;
    }
    
    .social-btn {
      padding: 12px 24px;
      border: 2px solid #e0e0e0;
      border-radius: 50px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 500;
      min-width: 200px;
      white-space: nowrap;
    }
    
    .social-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-color: #dd4b39;
    }
    
    .social-btn.google { 
      color: #dd4b39;
    }
    
    .social-btn.google:hover {
      background: #dd4b39;
      color: white;
    }
    
    .terms-checkbox {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .terms-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    
    .terms-link {
      color: #1abc9c;
      text-decoration: none;
    }
    
    .terms-link:hover {
      text-decoration: underline;
    }
    
    .hero-content {
      z-index: 2;
    }
    
    .hero-title {
      font-size: 3.5rem;
      font-weight: bold;
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .hero-subtitle {
      font-size: 1.2rem;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    
    .logo {
      max-width: 150px;
      margin-bottom: 30px;
    }
    
    .alert {
      padding: 12px 16px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 8px;
    }
    
    .alert-info {
      color: #0c5460;
      background-color: #d1ecf1;
      border-color: #bee5eb;
    }
    
    @media (max-width: 768px) {
      .auth-container {
        flex-direction: column;
      }
      
      .auth-right {
        display: none;
      }
      
      .auth-left {
        padding: 30px;
      }
      
      .auth-title {
        font-size: 2rem;
        text-align: center;
      }
      
      .social-btn {
        min-width: 100%;
        font-size: 14px;
      }
      
      .social-btn span {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <dotlottie-wc 
            src="https://lottie.host/22866d75-292a-42dc-ae8a-72f6f903386d/dwhv5hvZ72.lottie" 
            style="width: 300px; height: 300px" 
            speed="1" 
            autoplay 
            loop>
        </dotlottie-wc>
        <div class="loading-text">LuxuryHavenTravel</div>
        <div class="loading-subtext">ƒêang t·∫£i n·ªôi dung...</div>
    </div>

  <div class="auth-container">
    <!-- Left Side - Form -->
    <div class="auth-left">
      <div class="auth-form-container">
        <!-- Logo -->
        <div class="text-center mb-4">
          <img src="images/LuxuryHavenTravel.png" alt="LuxuryHaven Logo" class="logo">
        </div>

        <!-- Th√¥ng b√°o c·∫•u h√¨nh Google (s·∫Ω ·∫©n sau khi c·∫•u h√¨nh xong) -->
        <div id="google-config-notice" class="alert alert-info mb-3" style="display: block; border-radius: 15px; font-size: 14px;">
          <i class="fas fa-info-circle me-2"></i>
          <strong>H∆∞·ªõng d·∫´n c·∫•u h√¨nh Google OAuth:</strong>
          <ol style="margin: 10px 0 0 20px; font-size: 13px;">
            <li>V√†o <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
            <li>Ch·ªçn <strong>Authentication ‚Üí Settings ‚Üí Authorized domains</strong></li>
            <li>Th√™m domain: <strong>127.0.0.1:5500</strong></li>
            <li>V√†o <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
            <li>C·∫•u h√¨nh OAuth 2.0 Client ID v·ªõi domain t∆∞∆°ng ·ª©ng</li>
          </ol>
          <button onclick="testGoogleConfig()" class="btn btn-sm btn-outline-info mt-2">
            <i class="fas fa-check-circle me-1"></i>Ki·ªÉm tra c·∫•u h√¨nh
          </button>
        </div>

        <!-- Form ƒêƒÉng nh·∫≠p -->
        <div id="login-form-container">
          <h2 class="auth-title">ƒêƒÇNG NH·∫¨P</h2>
          <form id="login-form">
            <div class="form-group">
              <input type="email" class="form-control" id="login-email" required placeholder="Email">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" id="login-password" required placeholder="M·∫≠t kh·∫©u">
            </div>
            <button type="submit" class="btn-primary">
              ƒêƒÇNG NH·∫¨P
            </button>
            
            <!-- Social Login -->
            <div class="social-buttons">
              <div class="social-btn google" title="ƒêƒÉng nh·∫≠p v·ªõi Google">
                <i class="fab fa-google me-2"></i>
                <span>ƒêƒÉng nh·∫≠p v·ªõi Google</span>
              </div>
            </div>
            
            <div class="text-center mt-3">
              <p class="mb-2">
                <a href="#" class="auth-switch" id="show-register">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</a>
              </p>
              <p class="mb-2">
                <a href="#" class="auth-switch" id="show-forgot">Qu√™n m·∫≠t kh·∫©u?</a>
              </p>
              <a href="index.html" class="text-muted text-decoration-none">
                <i class="fas fa-arrow-left me-2"></i>Quay v·ªÅ trang ch·ªß
              </a>
            </div>
          </form>
        </div>

        <!-- Form ƒêƒÉng k√Ω -->
        <div id="register-form-container" style="display: none;">
          <h2 class="auth-title">ƒêƒÇNG K√ù</h2>
          <form id="register-form">
            <div class="form-group">
              <input type="text" class="form-control" id="register-username" required placeholder="H·ªç v√† t√™n">
            </div>
            <div class="form-group">
              <input type="email" class="form-control" id="register-email" required placeholder="Email">
            </div>
            <div class="form-group">
              <input type="password" class="form-control" id="register-password" required placeholder="M·∫≠t kh·∫©u">
            </div>
            
            <div class="terms-checkbox">
              <input type="checkbox" id="terms-agree" required>
              <label for="terms-agree">T√¥i ƒë·ªìng √Ω v·ªõi t·∫•t c·∫£ c√°c ƒëi·ªÅu kho·∫£n trong <a href="footer/terms.html" class="terms-link">ƒëi·ªÅu kho·∫£n d·ªãch v·ª•</a></label>
            </div>
            
            <button type="submit" class="btn-primary">
              ƒêƒÇNG K√ù
            </button>
            
            <!-- Social Login -->
            <div class="social-buttons">
              <div class="social-btn google" title="ƒêƒÉng k√Ω v·ªõi Google">
                <i class="fab fa-google me-2"></i>
                <span>ƒêƒÉng k√Ω v·ªõi Google</span>
              </div>
            </div>
            
            <div class="text-center mt-3">
              <p class="mb-2">
                <a href="#" class="auth-switch" id="show-login">ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p</a>
              </p>
              <a href="index.html" class="text-muted text-decoration-none">
                <i class="fas fa-arrow-left me-2"></i>Quay v·ªÅ trang ch·ªß
              </a>
            </div>
          </form>
        </div>

        <!-- Form Qu√™n m·∫≠t kh·∫©u -->
        <div id="forgot-form-container" style="display: none;">
          <h2 class="auth-title">KH√îI PH·ª§C M·∫¨T KH·∫®U</h2>
          <p class="text-muted mb-4">Nh·∫≠p email c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n li√™n k·∫øt kh√¥i ph·ª•c m·∫≠t kh·∫©u</p>
          <form id="forgot-form">
            <div class="form-group">
              <input type="email" class="form-control" id="forgot-email" required placeholder="Email">
            </div>
            <button type="submit" class="btn-primary">
              G·ª¨I LI√äN K·∫æT KH√îI PH·ª§C
            </button>
            <div class="text-center mt-3">
              <p class="mb-3">
                <a href="#" class="auth-switch" id="back-to-login">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
              </p>
              <a href="index.html" class="text-muted text-decoration-none">
                <i class="fas fa-arrow-left me-2"></i>Quay v·ªÅ trang ch·ªß
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Right Side - Hero Image -->
    <div class="auth-right">
      <div class="hero-content">
        <h1 class="hero-title">LUXURYHAVEN</h1>
        <p class="hero-subtitle">DU L·ªäCH SANG TR·ªåNG</p>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // Firebase c·∫•u h√¨nh
    const firebaseConfig = {
      apiKey: "AIzaSyDuX4_RKARM7g0K3BvoZPS8ADxVgrYQKYc",
      authDomain: "websitedatphongkhachsan.firebaseapp.com",
      databaseURL: "https://websitedatphongkhachsan-default-rtdb.firebaseio.com",
      projectId: "websitedatphongkhachsan",
      storageBucket: "websitedatphongkhachsan.appspot.com",
      messagingSenderId: "732884739524",
      appId: "1:732884739524:web:a9c34746f5704a9c3eb091",
      measurementId: "G-RC61EXTZH7"
    };

    // Kh·ªüi t·∫°o Firebase
    firebase.initializeApp(firebaseConfig);

    // Kh·ªüi t·∫°o Google Auth Provider
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    googleProvider.addScope('email');
    googleProvider.addScope('profile');

    // H√†m √°nh x·∫° ch·ª©c v·ª• v·ªõi trang t∆∞∆°ng ·ª©ng
    function getPageByRole(role) {
      console.log('üîé getPageByRole ƒë∆∞·ª£c g·ªçi v·ªõi role:', role, 'type:', typeof role);
      
      if (!role) return 'index.html';
      
      const rolePageMap = {
        // √Ånh x·∫° theo t√™n ch·ª©c v·ª• ƒë·∫ßy ƒë·ªß
        'Qu·∫£n l√Ω ƒë·ªëi t√°c': 'QLNV/affiliate-manager.html',
        'qu·∫£n l√Ω ƒë·ªëi t√°c': 'QLNV/affiliate-manager.html',
        'Affiliate Manager': 'QLNV/affiliate-manager.html',
        'affiliate manager': 'QLNV/affiliate-manager.html',
        'Ki·ªÉm duy·ªát ƒë·∫∑t ph√≤ng': 'QLNV/booking-moderator.html',
        'Tu√¢n th·ªß ph√°p l√Ω': 'QLNV/compliance-officer.html',
        'Qu·∫£n l√Ω n·ªôi dung': 'QLNV/content-admin.html',
        'H·ªó tr·ª£ kh√°ch h√†ng': 'QLNV/customer-support.html',
        'Ph√¢n t√≠ch d·ªØ li·ªáu': 'QLNV/data-analyst.html',
        'Qu·∫£n l√Ω t√†i ch√≠nh': 'QLNV/finance-manager.html',
        'Marketing & SEO': 'QLNV/marketing-seo.html',
        'Dashboard nh√¢n vi√™n': 'QLNV/staff-dashboard.html',
        'Ph√°t tri·ªÉn web': 'QLNV/web-developer.html',
        'L·ªÖ t√¢n (Front Desk)': 'QLNV/staff-dashboard.html',
        'Nh√¢n vi√™n l·ªÖ t√¢n': 'QLNV/staff-dashboard.html',
        'nh√¢n vi√™n': 'QLNV/staff-dashboard.html',
        'tr∆∞·ªüng ph√≤ng': 'QLNV/staff-dashboard.html',
        'ph√≥ tr∆∞·ªüng ph√≤ng': 'QLNV/staff-dashboard.html',
        
        // √Ånh x·∫° theo code ch·ª©c v·ª• t·ª´ Firebase (case-insensitive)
        'LT0001': 'QLNV/staff-dashboard.html', // Nh√¢n vi√™n l·ªÖ t√¢n
        'QL01': 'QLNV/affiliate-manager.html', // Qu·∫£n l√Ω ƒë·ªëi t√°c
        'KD01': 'QLNV/booking-moderator.html', // Ki·ªÉm duy·ªát ƒë·∫∑t ph√≤ng
        'PL01': 'QLNV/compliance-officer.html', // Tu√¢n th·ªß ph√°p l√Ω
        'PL1': 'QLNV/compliance-officer.html', // Tu√¢n th·ªß ph√°p l√Ω (alternative)
        'Pl1': 'QLNV/compliance-officer.html', // Tu√¢n th·ªß ph√°p l√Ω (case variation)
        'pl1': 'QLNV/compliance-officer.html', // Tu√¢n th·ªß ph√°p l√Ω (lowercase)
        'HT01': 'QLNV/customer-support.html', // H·ªó tr·ª£ kh√°ch h√†ng
        'PT01': 'QLNV/data-analyst.html', // Ph√¢n t√≠ch d·ªØ li·ªáu
        'QLTC01': 'QLNV/finance-manager.html', // Qu·∫£n l√Ω t√†i ch√≠nh
        'MK01': 'QLNV/marketing-seo.html', // Marketing & SEO
        'NV01': 'QLNV/staff-dashboard.html', // nh√¢n vi√™n
        'PTW01': 'QLNV/web-developer.html', // Ph√°t tri·ªÉn web
        'QL02': 'QLNV/affiliate-manager.html', // ph√≥ tr∆∞·ªüng ph√≤ng
        'AFF01': 'QLNV/affiliate-manager.html', // Affiliate Manager
        
        // Department codes (fallback)
        '01': 'QLNV/staff-dashboard.html', // L·ªÖ t√¢n
        
        // √Ånh x·∫° theo code ch·ª©c v·ª• (legacy)
        'cskh': 'QLNV/customer-support.html',
        'manager': 'QLNV/staff-dashboard.html',
        'marketing': 'QLNV/marketing-seo.html',
        'kythuat': 'QLNV/web-developer.html',
        'admin': 'admin-dashboard.html',
        'receptionist': 'QLNV/staff-dashboard.html',
        'housekeeping': 'QLNV/staff-dashboard.html',
        'affiliate': 'QLNV/affiliate-manager.html',
        'affiliate-manager': 'QLNV/affiliate-manager.html', // Qu·∫£n l√Ω ƒë·ªëi t√°c
        'affiliate manager': 'QLNV/affiliate-manager.html', // Qu·∫£n l√Ω ƒë·ªëi t√°c (c√≥ space)
        'qu·∫£n l√Ω ƒë·ªëi t√°c': 'QLNV/affiliate-manager.html', // Ti·∫øng Vi·ªát
        'quan ly doi tac': 'QLNV/affiliate-manager.html', // Kh√¥ng d·∫•u
        'content': 'QLNV/content-admin.html',
        'finance': 'QLNV/finance-manager.html',
        'analyst': 'QLNV/data-analyst.html',
        'compliance': 'QLNV/compliance-officer.html',
        'booking': 'QLNV/booking-moderator.html'
      };
      
      console.log('üìã Danh s√°ch rolePageMap keys:', Object.keys(rolePageMap));
      
      // Th·ª≠ exact match tr∆∞·ªõc
      console.log('üîç Ki·ªÉm tra exact match cho role:', role);
      if (rolePageMap[role]) {
        console.log('‚úÖ T√¨m th·∫•y exact match:', role, '‚Üí', rolePageMap[role]);
        return rolePageMap[role];
      }
      
      // Th·ª≠ case-insensitive match
      console.log('üîç Ki·ªÉm tra case-insensitive match cho role:', role);
      const roleKey = Object.keys(rolePageMap).find(key => 
        key.toLowerCase() === role.toLowerCase()
      );
      
      if (roleKey) {
        console.log('‚úÖ T√¨m th·∫•y case-insensitive match:', role, '‚Üí', rolePageMap[roleKey]);
        return rolePageMap[roleKey];
      }
      
      console.log('‚ùå Kh√¥ng t√¨m th·∫•y mapping cho role:', role);
      
      return 'index.html';
    }

    // H√†m l·∫•y role t·ª´ redirectPage
    function getRoleFromPage(redirectPage) {
      if (redirectPage === 'admin-dashboard.html') {
        return 'Admin';
      } else if (redirectPage.includes('affiliate-manager.html')) {
        return 'Affiliate Manager';
      } else if (redirectPage.includes('customer-support.html')) {
        return 'Customer Support';
      } else if (redirectPage.includes('marketing-seo.html')) {
        return 'Marketing SEO';
      } else if (redirectPage.includes('web-developer.html')) {
        return 'Web Developer';
      } else if (redirectPage.includes('content-admin.html')) {
        return 'Content Admin';
      } else if (redirectPage.includes('finance-manager.html')) {
        return 'Finance Manager';
      } else if (redirectPage.includes('data-analyst.html')) {
        return 'Data Analyst';
      } else if (redirectPage.includes('compliance-officer.html')) {
        return 'Compliance Officer';
      } else if (redirectPage.includes('booking-moderator.html')) {
        return 'Booking Moderator';
      } else if (redirectPage.includes('staff-dashboard.html')) {
        return 'Nh√¢n vi√™n';
      } else if (redirectPage.includes('QLNV/')) {
        return 'Nh√¢n vi√™n';
      }
      return 'Kh√°ch h√†ng';
    }

    // H√†m ki·ªÉm tra ch·ª©c v·ª• t·ª´ Firebase v√† chuy·ªÉn h∆∞·ªõng (tr·∫£ v·ªÅ c·∫£ role v√† page)
    function checkUserRoleAndRedirectWithInfo(email) {
      return checkUserRoleAndRedirect(email).then((redirectPage) => {
        const role = getRoleFromPage(redirectPage);
        return {
          redirectPage: redirectPage,
          role: role
        };
      });
    }

    // H√†m ki·ªÉm tra ch·ª©c v·ª• t·ª´ Firebase v√† chuy·ªÉn h∆∞·ªõng
    function checkUserRoleAndRedirect(email) {
      // Ki·ªÉm tra admin tr∆∞·ªõc
      if (email === 'quantrikhachsan@gmail.com') {
        return Promise.resolve('admin-dashboard.html');
      }
      
      // Ki·ªÉm tra c√°c email test cho Affiliate Manager
      const affiliateEmails = [
        'affiliate@email.com',
        'affiliate@luxurytravel.vn', 
        'admin@luxurytravel.vn',
        'affiliate.manager@luxurytravel.vn'
      ];
      
      if (affiliateEmails.includes(email.toLowerCase())) {
        return Promise.resolve('QLNV/affiliate-manager.html');
      }

      // T√¨m ki·∫øm trong danh s√°ch nh√¢n vi√™n
      return Promise.all([
        firebase.database().ref('staff').once('value'),
        firebase.database().ref('roles').once('value'),
        firebase.database().ref('staffAccess').once('value')
      ])
        .then(([staffSnapshot, rolesSnapshot, staffAccessSnapshot]) => {
          const staffData = staffSnapshot.val();
          const rolesData = rolesSnapshot.val();
          const staffAccessData = staffAccessSnapshot.val();
          
          console.log('üîç Ki·ªÉm tra staffAccess cho email:', email);
          
          // Chuy·ªÉn ƒë·ªïi email th√†nh key format (thay @ v√† . th√†nh _)
          const emailKey = email.replace(/[@.]/g, '_');
          console.log('- Email key:', emailKey);
          
          // Ki·ªÉm tra trong staffAccess tr∆∞·ªõc
          if (staffAccessData && staffAccessData[emailKey]) {
            const role = staffAccessData[emailKey];
            console.log('‚úÖ T√¨m th·∫•y trong staffAccess:', emailKey, '‚Üí', role);
            
            let page = getPageByRole(role);
            console.log('- Role mapping:', role, '‚Üí', page);
            
            if (page !== 'index.html') {
              return page;
            }
          }
          
          if (!staffData) {
            console.log('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu nh√¢n vi√™n');
            return 'index.html';
          }

          // T·∫°o map role code -> role name
          const roleCodeToName = {};
          if (rolesData) {
            Object.values(rolesData).forEach(role => {
              if (role.code && role.name) {
                roleCodeToName[role.code] = role.name;
              }
            });
          }

          // T√¨m nh√¢n vi√™n c√≥ email kh·ªõp
          for (let staffId in staffData) {
            const staff = staffData[staffId];
            // Ki·ªÉm tra c·∫£ email v√† √™mmail (typo)
            const staffEmail = staff.email || staff.√™mmail || staff['√™mmail'];
            if (staffEmail === email) {
              console.log('T√¨m th·∫•y nh√¢n vi√™n:', staff);
              
              let role = staff.role || staff.chucVu;
              if (role) {
                console.log('üîç Debug th√¥ng tin role:');
                console.log('- Original role:', role);
                console.log('- Type of role:', typeof role);
                
                // N·∫øu role l√† code, chuy·ªÉn ƒë·ªïi th√†nh t√™n ƒë·∫ßy ƒë·ªß
                const fullRoleName = roleCodeToName[role] || role;
                console.log('- Role code ‚Üí Full name:', role, '‚Üí', fullRoleName);
                
                // Th·ª≠ mapping tr·ª±c ti·∫øp v·ªõi role code tr∆∞·ªõc
                let page = getPageByRole(role);
                console.log('- Direct role mapping:', role, '‚Üí', page);
                
                // N·∫øu kh√¥ng t√¨m th·∫•y, th·ª≠ v·ªõi full name
                if (page === 'index.html' && fullRoleName !== role) {
                  page = getPageByRole(fullRoleName);
                  console.log('- Full name mapping:', fullRoleName, '‚Üí', page);
                }
                
                console.log('‚úÖ Final redirect:', page);
                return page;
              }
              console.log('‚ùå Kh√¥ng t√¨m th·∫•y role cho nh√¢n vi√™n');
              break;
            }
          }
          
          console.log('Kh√¥ng t√¨m th·∫•y ch·ª©c v·ª•, chuy·ªÉn v·ªÅ index');
          return 'index.html';
        })
        .catch((error) => {
          console.error('L·ªói khi ki·ªÉm tra ch·ª©c v·ª•:', error);
          return 'index.html';
        });
    }

    // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
    firebase.auth().onAuthStateChanged(function(user) {
      if (user && (window.location.pathname.includes('login.html') || window.location.pathname.includes('auth.html'))) {
        // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p v√† ƒëang ·ªü trang login, chuy·ªÉn h∆∞·ªõng
        const email = user.email;
        checkUserRoleAndRedirect(email).then((redirectPage) => {
          window.location.href = redirectPage;
        });
      }
    });

    // Ki·ªÉm tra c·∫•u h√¨nh Google OAuth v√† hi·ªÉn th·ªã th√¥ng b√°o n·∫øu c·∫ßn
    function checkGoogleAuthConfig() {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        // N·∫øu t·∫°o ƒë∆∞·ª£c provider th√¨ ·∫©n th√¥ng b√°o
        const notice = document.getElementById('google-config-notice');
        if (notice) {
          notice.style.display = 'none';
        }
      } catch (error) {
        console.log('Google Auth ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·∫ßy ƒë·ªß');
        const notice = document.getElementById('google-config-notice');
        if (notice) {
          notice.style.display = 'block';
        }
      }
    }

    // G·ªçi ki·ªÉm tra khi trang load
    document.addEventListener('DOMContentLoaded', checkGoogleAuthConfig);

    // Function ki·ªÉm tra c·∫•u h√¨nh Google
    function testGoogleConfig() {
      showLoading('ƒêang ki·ªÉm tra c·∫•u h√¨nh Google...');
      
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('email');
        provider.addScope('profile');
        
        // Th·ª≠ t·∫°o popup (kh√¥ng th·ª±c s·ª± ƒëƒÉng nh·∫≠p)
        firebase.auth().fetchSignInMethodsForEmail('test@gmail.com')
          .then(() => {
            Swal.fire({
              icon: 'success',
              title: 'C·∫•u h√¨nh Google OAuth OK!',
              text: 'Firebase c√≥ th·ªÉ k·∫øt n·ªëi v·ªõi Google. B·∫°n c√≥ th·ªÉ th·ª≠ ƒëƒÉng nh·∫≠p Google.',
              confirmButtonColor: '#1abc9c'
            }).then(() => {
              // ·∫®n th√¥ng b√°o c·∫•u h√¨nh
              const notice = document.getElementById('google-config-notice');
              if (notice) {
                notice.style.display = 'none';
              }
            });
          })
          .catch((error) => {
            console.error('L·ªói ki·ªÉm tra c·∫•u h√¨nh:', error);
            Swal.fire({
              icon: 'warning',
              title: 'C·∫ßn c·∫•u h√¨nh th√™m',
              html: `
                <p>Firebase ƒë√£ k·∫øt n·ªëi nh∆∞ng c·∫ßn c·∫•u h√¨nh domain:</p>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                  <strong>Domain hi·ªán t·∫°i:</strong> ${window.location.origin}<br>
                  <strong>C·∫ßn th√™m v√†o Firebase:</strong> 127.0.0.1:5500
                </div>
              `,
              confirmButtonColor: '#1abc9c'
            });
          });
      } catch (error) {
        console.error('L·ªói kh·ªüi t·∫°o Google Provider:', error);
        Swal.fire({
          icon: 'error',
          title: 'L·ªói c·∫•u h√¨nh Firebase',
          text: 'Kh√¥ng th·ªÉ kh·ªüi t·∫°o Google Provider. Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh Firebase.',
          confirmButtonColor: '#1abc9c'
        });
      }
    }

    // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c form v·ªõi validation
    function showForm(formToShow) {
      // ·∫®n t·∫•t c·∫£ form
      document.getElementById('login-form-container').style.display = 'none';
      document.getElementById('register-form-container').style.display = 'none';
      document.getElementById('forgot-form-container').style.display = 'none';
      
      // Hi·ªán form ƒë∆∞·ª£c ch·ªçn
      document.getElementById(formToShow).style.display = 'block';
      
      // Reset form khi chuy·ªÉn ƒë·ªïi
      const forms = document.querySelectorAll('form');
      forms.forEach(form => form.reset());
    }

    // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c form
    document.getElementById('show-register').addEventListener('click', function(e) {
      e.preventDefault();
      showForm('register-form-container');
    });

    document.getElementById('show-login').addEventListener('click', function(e) {
      e.preventDefault();
      showForm('login-form-container');
    });

    document.getElementById('show-forgot').addEventListener('click', function(e) {
      e.preventDefault();
      showForm('forgot-form-container');
    });

    document.getElementById('back-to-login').addEventListener('click', function(e) {
      e.preventDefault();
      showForm('login-form-container');
    });

    // H√†m validation email
    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    // H√†m validation m·∫≠t kh·∫©u
    function validatePassword(password) {
      return password && password.length >= 6;
    }

    // H√†m x·ª≠ l√Ω ƒëƒÉng nh·∫≠p Google
    function signInWithGoogle() {
      showLoading('ƒêang ƒëƒÉng nh·∫≠p v·ªõi Google...');
      
      // C·∫•u h√¨nh Google Provider v·ªõi c√°c th√¥ng s·ªë c·∫ßn thi·∫øt
      const provider = new firebase.auth.GoogleAuthProvider();
      provider.addScope('email');
      provider.addScope('profile');
      provider.setCustomParameters({
        'prompt': 'select_account'
      });
      
      firebase.auth().signInWithPopup(provider)
        .then((result) => {
          const user = result.user;
          const isNewUser = result.additionalUserInfo.isNewUser;
          
          // N·∫øu l√† user m·ªõi, l∆∞u th√¥ng tin v√†o database
          if (isNewUser) {
            return firebase.database().ref('users/' + user.uid).set({
              name: user.displayName || 'Google User',
              email: user.email,
              photoURL: user.photoURL || '',
              provider: 'google',
              loyaltyPoints: 0,
              memberLevel: 'ƒê·ªìng',
              createdAt: firebase.database.ServerValue.TIMESTAMP,
              updatedAt: firebase.database.ServerValue.TIMESTAMP
            });
          } else {
            // C·∫≠p nh·∫≠t th√¥ng tin user hi·ªán t·∫°i
            return firebase.database().ref('users/' + user.uid).update({
              name: user.displayName || 'Google User',
              photoURL: user.photoURL || '',
              updatedAt: firebase.database.ServerValue.TIMESTAMP
            });
          }
        })
        .then(() => {
          const user = firebase.auth().currentUser;
          const email = user.email;
          
          // Ki·ªÉm tra ch·ª©c v·ª• v√† chuy·ªÉn h∆∞·ªõng
          checkUserRoleAndRedirectWithInfo(email).then((userInfo) => {
            // L∆∞u th√¥ng tin user v√†o localStorage
            const userData = {
              email: email,
              name: user.displayName || user.email.split('@')[0],
              role: userInfo.role,
              loginTime: new Date().toISOString(),
              loginMethod: 'Google'
            };
            
            localStorage.setItem('loggedInUser', JSON.stringify(userData));
            localStorage.setItem('userRole', userInfo.role);
            localStorage.setItem('userEmail', email);
            
            console.log('‚úÖ ƒê√£ l∆∞u th√¥ng tin user:', userData);
            
            Swal.fire({
              icon: 'success',
              title: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng!',
              text: `Ch√†o m·ª´ng ${user.displayName || user.email}!`,
              timer: 1500,
              showConfirmButton: false
            }).then(() => {
              window.location.href = userInfo.redirectPage;
            });
          });
        })
        .catch((error) => {
          console.error('L·ªói ƒëƒÉng nh·∫≠p Google:', error);
          let errorMessage = 'ƒê√£ x·∫£y ra l·ªói khi ƒëƒÉng nh·∫≠p v·ªõi Google';
          
          switch (error.code) {
            case 'auth/popup-closed-by-user':
              errorMessage = 'C·ª≠a s·ªï ƒëƒÉng nh·∫≠p ƒë√£ b·ªã ƒë√≥ng. Vui l√≤ng th·ª≠ l·∫°i.';
              break;
            case 'auth/popup-blocked':
              errorMessage = 'Popup b·ªã ch·∫∑n. Vui l√≤ng cho ph√©p popup v√† th·ª≠ l·∫°i.';
              break;
            case 'auth/cancelled-popup-request':
              errorMessage = 'Y√™u c·∫ßu ƒëƒÉng nh·∫≠p ƒë√£ b·ªã h·ªßy.';
              break;
            case 'auth/network-request-failed':
              errorMessage = 'L·ªói k·∫øt n·ªëi m·∫°ng. Vui l√≤ng ki·ªÉm tra internet.';
              break;
            case 'auth/account-exists-with-different-credential':
              errorMessage = 'T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i v·ªõi ph∆∞∆°ng th·ª©c ƒëƒÉng nh·∫≠p kh√°c.';
              break;
            case 'auth/unauthorized-domain':
              errorMessage = 'Domain ch∆∞a ƒë∆∞·ª£c ·ªßy quy·ªÅn! Vui l√≤ng th√™m 127.0.0.1:5500 v√†o Firebase Console ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains';
              break;
            case 'auth/operation-not-allowed':
              errorMessage = 'ƒêƒÉng nh·∫≠p Google ch∆∞a ƒë∆∞·ª£c k√≠ch ho·∫°t trong Firebase Console.';
              break;
            case 'auth/invalid-api-key':
              errorMessage = 'API key kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh Firebase.';
              break;
            case 'auth/app-not-authorized':
              errorMessage = '·ª®ng d·ª•ng ch∆∞a ƒë∆∞·ª£c ·ªßy quy·ªÅn. Vui l√≤ng c·∫•u h√¨nh Google Cloud Console.';
              break;
            default:
              errorMessage = `L·ªói: ${error.message}`;
              // N·∫øu l√† l·ªói domain, hi·ªÉn th·ªã h∆∞·ªõng d·∫´n c·ª• th·ªÉ
              if (error.message && error.message.includes('domain')) {
                errorMessage = 'L·ªói domain! Vui l√≤ng th√™m 127.0.0.1:5500 v√†o Firebase Console ‚Üí Authentication ‚Üí Authorized domains';
              }
          }

          Swal.fire({
            icon: 'error',
            title: 'L·ªói ƒëƒÉng nh·∫≠p Google',
            html: `
              <div style="text-align: left;">
                <p><strong>L·ªói:</strong> ${errorMessage}</p>
                ${error.code === 'auth/unauthorized-domain' ? `
                  <hr>
                  <p><strong>C√°ch kh·∫Øc ph·ª•c:</strong></p>
                  <ol style="text-align: left; padding-left: 20px;">
                    <li>Truy c·∫≠p <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
                    <li>Ch·ªçn project <strong>websitedatphongkhachsan</strong></li>
                    <li>V√†o <strong>Authentication ‚Üí Settings ‚Üí Authorized domains</strong></li>
                    <li>Th√™m domain: <strong>127.0.0.1:5500</strong></li>
                    <li>Nh·∫•n Save v√† th·ª≠ l·∫°i</li>
                  </ol>
                ` : ''}
              </div>
            `,
            confirmButtonColor: '#1abc9c',
            confirmButtonText: 'ƒê√£ hi·ªÉu'
          });
        });
    }

    // H√†m hi·ªÉn th·ªã loading
    function showLoading(title = 'ƒêang x·ª≠ l√Ω...') {
      Swal.fire({
        title: title,
        allowOutsideClick: false,
        allowEscapeKey: false,
        showConfirmButton: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });
    }

    // X·ª≠ l√Ω form ƒëƒÉng nh·∫≠p v·ªõi validation c·∫£i thi·ªán
    document.getElementById('login-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;

      // Validation c∆° b·∫£n
      if (!email || !password) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Vui l√≤ng nh·∫≠p c·∫£ email v√† m·∫≠t kh·∫©u',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Validation email format
      if (!validateEmail(email)) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Hi·ªÉn th·ªã loading
      showLoading('ƒêang ƒëƒÉng nh·∫≠p...');

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          
          // Ki·ªÉm tra ch·ª©c v·ª• v√† chuy·ªÉn h∆∞·ªõng
          checkUserRoleAndRedirectWithInfo(email).then((userInfo) => {
            let userMessage = 'Ch√†o m·ª´ng b·∫°n!';
            
            if (userInfo.role === 'Admin') {
              userMessage = 'Ch√†o m·ª´ng Qu·∫£n tr·ªã vi√™n!';
            } else if (userInfo.role === 'Affiliate Manager') {
              userMessage = 'Ch√†o m·ª´ng Affiliate Manager!';
            } else if (userInfo.role.includes('Nh√¢n vi√™n') || userInfo.redirectPage.includes('QLNV/')) {
              userMessage = 'Ch√†o m·ª´ng Nh√¢n vi√™n!';
            }
            
            // L∆∞u th√¥ng tin user v√†o localStorage
            const userData = {
              email: email,
              name: user.displayName || email.split('@')[0],
              role: userInfo.role,
              loginTime: new Date().toISOString(),
              loginMethod: 'Email/Password'
            };
            
            localStorage.setItem('loggedInUser', JSON.stringify(userData));
            localStorage.setItem('userRole', userInfo.role);
            localStorage.setItem('userEmail', email);
            
            console.log('‚úÖ ƒê√£ l∆∞u th√¥ng tin user:', userData);
            
            Swal.fire({
              icon: 'success',
              title: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng!',
              text: userMessage,
              confirmButtonColor: '#1abc9c'
            }).then(() => {
              window.location.href = userInfo.redirectPage;
            });
          });
        })
        .catch((error) => {
          console.error('L·ªói ƒëƒÉng nh·∫≠p:', error);
          let errorMessage = 'ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh ƒëƒÉng nh·∫≠p';
          
          switch (error.code) {
            case 'auth/user-not-found':
              errorMessage = 'Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n v·ªõi email n√†y';
              break;
            case 'auth/wrong-password':
              errorMessage = 'M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c';
              break;
            case 'auth/invalid-email':
              errorMessage = 'Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng';
              break;
            case 'auth/too-many-requests':
              errorMessage = 'Qu√° nhi·ªÅu y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i sau';
              break;
            case 'auth/network-request-failed':
              errorMessage = 'L·ªói k·∫øt n·ªëi m·∫°ng. Vui l√≤ng ki·ªÉm tra internet';
              break;
            case 'auth/invalid-credential':
              errorMessage = 'Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá';
              break;
          }

          Swal.fire({
            icon: 'error',
            title: 'L·ªói ƒëƒÉng nh·∫≠p',
            text: errorMessage,
            confirmButtonColor: '#1abc9c'
          });
        });
    });

    // X·ª≠ l√Ω form ƒëƒÉng k√Ω v·ªõi validation c·∫£i thi·ªán
    document.getElementById('register-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const username = document.getElementById('register-username').value.trim();
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value;
      const termsAccepted = document.getElementById('terms-agree').checked;

      // Validation c∆° b·∫£n
      if (!username || !email || !password) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Validation t√™n
      if (username.length < 2) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'H·ªç v√† t√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Validation email
      if (!validateEmail(email)) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Validation m·∫≠t kh·∫©u
      if (!validatePassword(password)) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Validation ƒëi·ªÅu kho·∫£n
      if (!termsAccepted) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Vui l√≤ng ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n d·ªãch v·ª•',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Hi·ªÉn th·ªã loading
      showLoading('ƒêang t·∫°o t√†i kho·∫£n...');

      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          
          // C·∫≠p nh·∫≠t profile v√† l∆∞u v√†o database
          return Promise.all([
            user.updateProfile({
              displayName: username
            }),
            firebase.database().ref('users/' + user.uid).set({
              name: username,
              email: user.email,
              loyaltyPoints: 0,
              memberLevel: 'ƒê·ªìng',
              createdAt: firebase.database.ServerValue.TIMESTAMP,
              updatedAt: firebase.database.ServerValue.TIMESTAMP
            })
          ]);
        })
        .then(() => {
          Swal.fire({
            icon: 'success',
            title: 'ƒêƒÉng k√Ω th√†nh c√¥ng!',
            text: 'Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi LuxuryHavenTravel!',
            confirmButtonColor: '#1abc9c'
          }).then(() => {
            window.location.href = 'index.html';
          });
        })
        .catch((error) => {
          console.error('L·ªói ƒëƒÉng k√Ω:', error);
          let errorMessage = 'ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh ƒëƒÉng k√Ω';
          
          switch (error.code) {
            case 'auth/email-already-in-use':
              errorMessage = 'Email n√†y ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng';
              break;
            case 'auth/invalid-email':
              errorMessage = 'Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng';
              break;
            case 'auth/weak-password':
              errorMessage = 'M·∫≠t kh·∫©u qu√° y·∫øu. Vui l√≤ng ch·ªçn m·∫≠t kh·∫©u m·∫°nh h∆°n';
              break;
            case 'auth/network-request-failed':
              errorMessage = 'L·ªói k·∫øt n·ªëi m·∫°ng. Vui l√≤ng ki·ªÉm tra internet';
              break;
            case 'auth/operation-not-allowed':
              errorMessage = 'ƒêƒÉng k√Ω b·∫±ng email/m·∫≠t kh·∫©u ch∆∞a ƒë∆∞·ª£c k√≠ch ho·∫°t';
              break;
          }

          Swal.fire({
            icon: 'error',
            title: 'L·ªói ƒëƒÉng k√Ω',
            text: errorMessage,
            confirmButtonColor: '#1abc9c'
          });
        });
    });

    // X·ª≠ l√Ω form qu√™n m·∫≠t kh·∫©u v·ªõi validation c·∫£i thi·ªán
    document.getElementById('forgot-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const email = document.getElementById('forgot-email').value.trim();

      // Validation c∆° b·∫£n
      if (!email) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Vui l√≤ng nh·∫≠p email c·ªßa b·∫°n',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Validation email format
      if (!validateEmail(email)) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói!',
          text: 'Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng',
          confirmButtonColor: '#1abc9c'
        });
        return;
      }

      // Hi·ªÉn th·ªã loading
      showLoading('ƒêang g·ª≠i email...');

      firebase.auth().sendPasswordResetEmail(email)
        .then(() => {
          Swal.fire({
            icon: 'success',
            title: 'Email ƒë√£ ƒë∆∞·ª£c g·ª≠i!',
            text: 'Vui l√≤ng ki·ªÉm tra email ƒë·ªÉ kh√¥i ph·ª•c m·∫≠t kh·∫©u.',
            confirmButtonColor: '#1abc9c'
          }).then(() => {
            // Quay v·ªÅ form ƒëƒÉng nh·∫≠p
            showForm('login-form-container');
          });
        })
        .catch((error) => {
          console.error('L·ªói kh√¥i ph·ª•c m·∫≠t kh·∫©u:', error);
          let errorMessage = 'ƒê√£ x·∫£y ra l·ªói khi g·ª≠i email';
          
          switch (error.code) {
            case 'auth/user-not-found':
              errorMessage = 'Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n v·ªõi email n√†y';
              break;
            case 'auth/invalid-email':
              errorMessage = 'Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng';
              break;
            case 'auth/network-request-failed':
              errorMessage = 'L·ªói k·∫øt n·ªëi m·∫°ng. Vui l√≤ng ki·ªÉm tra internet';
              break;
            case 'auth/too-many-requests':
              errorMessage = 'Qu√° nhi·ªÅu y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i sau';
              break;
          }

          Swal.fire({
            icon: 'error',
            title: 'L·ªói!',
            text: errorMessage,
            confirmButtonColor: '#1abc9c'
          });
        });
    });

    // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p Google v·ªõi fallback
    document.addEventListener('DOMContentLoaded', function() {
      const googleBtns = document.querySelectorAll('.social-btn.google');
      googleBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Ki·ªÉm tra xem Google Auth c√≥ s·∫µn kh√¥ng
          if (typeof firebase === 'undefined' || !firebase.auth) {
            Swal.fire({
              icon: 'error',
              title: 'L·ªói!',
              text: 'Firebase Authentication ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng t·∫£i l·∫°i trang.',
              confirmButtonColor: '#1abc9c'
            });
            return;
          }
          
          // Th·ª≠ ƒëƒÉng nh·∫≠p v·ªõi Google
          try {
            signInWithGoogle();
          } catch (error) {
            console.error('L·ªói khi kh·ªüi t·∫°o Google Sign-in:', error);
            Swal.fire({
              icon: 'error',
              title: 'Kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p',
              text: 'T√≠nh nƒÉng ƒëƒÉng nh·∫≠p Google hi·ªán kh√¥ng kh·∫£ d·ª•ng. Vui l√≤ng s·ª≠ d·ª•ng email/m·∫≠t kh·∫©u.',
              confirmButtonColor: '#1abc9c'
            });
          }
        });
      });
    });

    // X·ª≠ l√Ω l·ªói to√†n c·ª•c
    window.addEventListener('error', function(e) {
      console.error('L·ªói JavaScript:', e.error);
      // C√≥ th·ªÉ th√™m logging ho·∫∑c reporting l·ªói ·ªü ƒë√¢y
    });

    // X·ª≠ l√Ω l·ªói Firebase
    window.addEventListener('unhandledrejection', function(e) {
      console.error('L·ªói Promise:', e.reason);
      // C√≥ th·ªÉ th√™m logging ho·∫∑c reporting l·ªói ·ªü ƒë√¢y
    });
  </script>
</body>
</html>

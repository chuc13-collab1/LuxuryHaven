<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuyên viên pháp lý (Compliance Officer)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <style>
        :root { --main-bg: #181c2f; --sidebar-bg: #23244a; --card-bg: #23244a; --accent: #7c3aed; --accent2: #00eaff; --text: #f3f6fa; --text-muted: #b0b8d1; --border: #2e325a; --shadow: 0 4px 24px 0 rgba(44, 62, 80, 0.15); }
        body { background: var(--main-bg); color: var(--text); font-family: 'Poppins', Arial, sans-serif; margin: 0; }
        .sidebar { width: 240px; background: var(--sidebar-bg); color: var(--text); min-height: 100vh; position: fixed; top: 0; left: 0; z-index: 100; display: flex; flex-direction: column; }
        .sidebar .logo { padding: 32px 0 24px 0; text-align: center; font-size: 1.6rem; font-weight: 700; letter-spacing: 2px; color: var(--accent); }
        .sidebar .nav-item { display: flex; align-items: center; padding: 14px 32px; color: var(--text-muted); text-decoration: none; font-size: 1.08rem; border-left: 4px solid transparent; transition: background 0.2s, color 0.2s, border-color 0.2s; }
        .sidebar .nav-item.active, .sidebar .nav-item:hover { background: #1a1d36; color: var(--accent2); border-left: 4px solid var(--accent); }
        .sidebar .nav-item i { margin-right: 14px; font-size: 1.2rem; }
        .sidebar-footer { margin-top: auto; padding: 24px 32px; }
        .sidebar-footer .btn { width: 100%; background: var(--accent); color: #fff; border: none; border-radius: 8px; font-weight: 500; }
        .main-container { margin-left: 240px; min-height: 100vh; background: var(--main-bg); }
        .main-header { background: #1a1d36; border-bottom: 1px solid var(--border); padding: 20px 40px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 10; }
        .main-header .user-info { display: flex; align-items: center; gap: 14px; }
        .main-header .user-info img { width: 44px; height: 44px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); }
        .content-wrapper { padding: 40px 32px 32px 32px; max-width: 800px; margin: 0 auto; }
        .card-modern { background: var(--card-bg); border-radius: 18px; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 32px; padding: 0; }
        .card-modern .card-body { padding: 32px 28px; }
        .card-modern .card-title { color: var(--accent2); font-weight: 600; font-size: 1.2rem; margin-bottom: 18px; }
        .profile-info { display: flex; align-items: center; gap: 32px; }
        .profile-info img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); }
        .profile-info .info { font-size: 1.1rem; }
        .content-section { display: block; }
        @media (max-width: 900px) { .sidebar { width: 80px; } .main-container { margin-left: 80px; } .sidebar .nav-item { padding: 12px 10px; font-size: 0.95rem; } .sidebar .logo { font-size: 1.1rem; } }
        @media (max-width: 700px) { .sidebar { display: none; } .main-container { margin-left: 0; } .main-header { padding: 12px 10px; } .content-wrapper { padding: 12px 4px; } }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-hotel"></i> LUXSTAFF
        </div>
        <a href="#role" class="nav-item active" onclick="showSection('role')"><i class="fas fa-user-tie"></i> Vai trò</a>
        <a href="#hr" class="nav-item" onclick="showSection('hr')"><i class="fas fa-users"></i> Nhân sự</a>
        <a href="#settings" class="nav-item" onclick="showSection('settings')"><i class="fas fa-cogs"></i> Cài đặt</a>
        <div class="sidebar-footer">
            <button class="btn" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Đăng xuất</button>
        </div>
    </div>
    <div class="main-container">
        <header class="main-header">
            <h1 class="h4 mb-0" style="color:var(--accent2);">Chuyên viên pháp lý</h1>
            <div class="user-info">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Avatar">
                <span><strong>Compliance Officer</strong></span>
            </div>
        </header>
        <main class="content-wrapper">
            <!-- Section Vai trò (mặc định) -->
            <div id="roleSection" class="content-section">
                <!-- Dashboard thống kê -->
                <section class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <div class="card-modern">
                                <div class="card-body text-center">
                                    <h3 class="mb-1" style="color: var(--accent2);" id="totalOfficers">0</h3>
                                    <p class="mb-0">Tổng chuyên viên</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card-modern">
                                <div class="card-body text-center">
                                    <h3 class="mb-1" style="color: #28a745;" id="activeTasks">0</h3>
                                    <p class="mb-0">Nhiệm vụ đang thực hiện</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card-modern">
                                <div class="card-body text-center">
                                    <h3 class="mb-1" style="color: #ffc107;" id="urgentTasks">0</h3>
                                    <p class="mb-0">Nhiệm vụ khẩn cấp</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card-modern">
                                <div class="card-body text-center">
                                    <h3 class="mb-1" style="color: #17a2b8;" id="completedTasks">0</h3>
                                    <p class="mb-0">Hoàn thành tháng này</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            <section>
                <div class="card-modern mb-4">
                    <div class="card-body profile-info">
                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Avatar">
                        <div class="info">
                            <h4 class="mb-1" style="color:var(--accent2);">Chuyên viên pháp lý (Compliance Officer)</h4>
                            <div><i class="fas fa-briefcase me-2"></i> Đảm bảo pháp lý, quyền riêng tư người dùng</div>
                            <hr style="border-color: var(--border); margin: 16px 0;">
                            <div>
                                <strong style="color: var(--accent2);">Vai trò:</strong>
                                <ul style="margin: 8px 0; padding-left: 20px;">
                                    <li>Đảm bảo doanh nghiệp tuân thủ quy định pháp luật, quy tắc nội bộ và tiêu chuẩn ngành</li>
                                    <li>Bảo vệ quyền lợi, quyền riêng tư của khách hàng và nhân viên</li>
                                    <li>Ngăn ngừa rủi ro pháp lý, xử lý các vấn đề liên quan đến pháp luật</li>
                                </ul>
                                <strong style="color: var(--accent2);">Chức năng:</strong>
                                <ul style="margin: 8px 0; padding-left: 20px;">
                                    <li>Kiểm tra, giám sát việc tuân thủ quy định pháp luật, quy chế nội bộ</li>
                                    <li>Tư vấn pháp lý cho các phòng ban, bộ phận</li>
                                    <li>Soạn thảo, rà soát hợp đồng, văn bản pháp lý</li>
                                    <li>Đào tạo, phổ biến kiến thức pháp luật cho nhân viên</li>
                                    <li>Giải quyết tranh chấp, khiếu nại liên quan đến pháp lý</li>
                                    <li>Quản lý hồ sơ pháp lý, cập nhật các quy định mới của pháp luật</li>
                                    <li>Đảm bảo bảo mật thông tin và quyền riêng tư của khách hàng, nhân viên</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-modern">
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">Danh sách chuyên viên pháp lý</h5>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex gap-2">
                                <button class="btn btn-info btn-sm" onclick="generateReport()"><i class="fas fa-chart-bar"></i> Báo cáo</button>
                                <button class="btn btn-warning btn-sm" onclick="showFileManager()"><i class="fas fa-folder"></i> Hồ sơ</button>
                                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal"><i class="fas fa-plus"></i> Thêm mới</button>
                            </div>
                        </div>
                        <!-- Bộ lọc tìm kiếm -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="Tìm kiếm theo tên, email...">
                            </div>
                            <div class="col-md-3">
                                <select class="form-control form-control-sm" id="filterPosition">
                                    <option value="">Tất cả chức vụ</option>
                                    <option value="Trưởng phòng Pháp chế">Trưởng phòng Pháp chế</option>
                                    <option value="Chuyên viên Pháp lý cấp cao">Chuyên viên Pháp lý cấp cao</option>
                                    <option value="Chuyên viên Pháp lý">Chuyên viên Pháp lý</option>
                                    <option value="Chuyên viên Tuân thủ">Chuyên viên Tuân thủ</option>
                                    <option value="Luật sư tư vấn">Luật sư tư vấn</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-control form-control-sm" id="filterStatus">
                                    <option value="">Tất cả trạng thái</option>
                                    <option value="Đang làm việc">Đang làm việc</option>
                                    <option value="Tạm nghỉ">Tạm nghỉ</option>
                                    <option value="Nghỉ phép">Nghỉ phép</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-secondary btn-sm w-100" onclick="clearFilters()">Xóa lọc</button>
                            </div>
                        </div>
                        <table class="table table-dark table-hover align-middle" id="officerTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Họ tên</th>
                                    <th>Chức vụ</th>
                                    <th>Chuyên môn</th>
                                    <th>Email</th>
                                    <th>Điện thoại</th>
                                    <th>Trạng thái</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dữ liệu sẽ được render bằng JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            </div>

            <!-- Section Nhân sự -->
            <div id="hrSection" class="content-section" style="display: none;">
                <div class="card-modern mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Quản lý nhân sự phòng Pháp chế</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 style="color: var(--accent2);" id="hrTotalEmployees">0</h4>
                                        <p class="mb-0">Tổng nhân viên</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 style="color: #28a745;" id="hrActiveEmployees">0</h4>
                                        <p class="mb-0">Đang làm việc</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 style="color: #ffc107;" id="hrOnLeave">0</h4>
                                        <p class="mb-0">Đang nghỉ phép</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 style="color: #17a2b8;" id="hrNewThisMonth">0</h4>
                                        <p class="mb-0">Tuyển mới tháng này</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <h6>Chức năng quản lý nhân sự:</h6>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-success me-2" onclick="showRecruitment()"><i class="fas fa-user-plus"></i> Tuyển dụng</button>
                                <button class="btn btn-info" onclick="showTimesheet()"><i class="fas fa-clock"></i> Chấm công</button>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-calendar-alt me-2"></i>Lịch nghỉ phép</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="leaveCalendar">
                                            <p class="text-muted">Đang tải lịch nghỉ phép...</p>
                                        </div>
                                        <button class="btn btn-sm btn-primary mt-2" onclick="manageLeave()">Quản lý nghỉ phép</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-graduation-cap me-2"></i>Đào tạo & Phát triển</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Khóa Luật Doanh nghiệp 2024</span>
                                                <span class="badge bg-primary">5/10 người</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Chứng chỉ Tuân thủ quốc tế</span>
                                                <span class="badge bg-warning">3/8 người</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Kỹ năng đàm phán</span>
                                                <span class="badge bg-success">Hoàn thành</span>
                                            </li>
                                        </ul>
                                        <button class="btn btn-sm btn-success mt-2" onclick="manageTraining()">Quản lý đào tạo</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-chart-line me-2"></i>Đánh giá hiệu suất</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="performanceChart" width="400" height="200"></canvas>
                                        <button class="btn btn-sm btn-info mt-2" onclick="managePerformance()">Quản lý KPI</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-money-bill me-2"></i>Bảng lương & Phúc lợi</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-6">
                                                <h5 style="color: var(--accent2);">85.5M</h5>
                                                <p class="mb-0 small">Tổng lương tháng</p>
                                            </div>
                                            <div class="col-6">
                                                <h5 style="color: #28a745;">12.8M</h5>
                                                <p class="mb-0 small">Phúc lợi & Thưởng</p>
                                            </div>
                                        </div>
                                        <button class="btn btn-sm btn-warning mt-2" onclick="manageSalary()">Quản lý lương</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Cài đặt -->
            <div id="settingsSection" class="content-section" style="display: none;">
                <div class="card-modern mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Cài đặt hệ thống</h5>
                        
                        <div class="row g-4">
                            <!-- Cài đặt tài khoản -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-user-cog me-2"></i>Cài đặt tài khoản</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="accountSettingsForm">
                                            <div class="mb-3">
                                                <label class="form-label">Tên hiển thị</label>
                                                <input type="text" class="form-control" id="displayName" value="Compliance Officer">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="userEmail" value="compliance@luxhaven.com">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Đổi mật khẩu</label>
                                                <button type="button" class="btn btn-outline-warning btn-sm" onclick="changePassword()">Đổi mật khẩu</button>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Cài đặt bảo mật -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-shield-alt me-2"></i>Bảo mật</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="twoFactorAuth" checked>
                                            <label class="form-check-label" for="twoFactorAuth">
                                                Xác thực 2 yếu tố (2FA)
                                            </label>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="loginNotifications" checked>
                                            <label class="form-check-label" for="loginNotifications">
                                                Thông báo đăng nhập
                                            </label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Thời gian tự động đăng xuất (phút)</label>
                                            <select class="form-control" id="autoLogout">
                                                <option value="30">30 phút</option>
                                                <option value="60" selected>60 phút</option>
                                                <option value="120">2 giờ</option>
                                                <option value="0">Không tự động</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-success">Cập nhật bảo mật</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cài đặt hệ thống -->
                        <div class="row g-4 mt-2">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-cogs me-2"></i>Cấu hình hệ thống</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Ngôn ngữ</label>
                                            <select class="form-control" id="systemLanguage">
                                                <option value="vi" selected>Tiếng Việt</option>
                                                <option value="en">English</option>
                                                <option value="zh">中文</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Múi giờ</label>
                                            <select class="form-control" id="timezone">
                                                <option value="Asia/Ho_Chi_Minh" selected>GMT+7 (Việt Nam)</option>
                                                <option value="Asia/Bangkok">GMT+7 (Bangkok)</option>
                                                <option value="Asia/Singapore">GMT+8 (Singapore)</option>
                                            </select>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="darkMode" checked>
                                            <label class="form-check-label" for="darkMode">
                                                Chế độ tối
                                            </label>
                                        </div>
                                        <button class="btn btn-info">Lưu cấu hình</button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-bell me-2"></i>Thông báo</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="emailNotif" checked>
                                            <label class="form-check-label" for="emailNotif">
                                                Thông báo email
                                            </label>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="pushNotif" checked>
                                            <label class="form-check-label" for="pushNotif">
                                                Thông báo đẩy
                                            </label>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="taskReminders" checked>
                                            <label class="form-check-label" for="taskReminders">
                                                Nhắc nhở nhiệm vụ
                                            </label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Tần suất báo cáo</label>
                                            <select class="form-control" id="reportFrequency">
                                                <option value="daily">Hàng ngày</option>
                                                <option value="weekly" selected>Hàng tuần</option>
                                                <option value="monthly">Hàng tháng</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-warning">Cập nhật thông báo</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quản lý dữ liệu -->
                        <div class="row g-4 mt-2">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-database me-2"></i>Quản lý dữ liệu</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <button class="btn btn-success w-100 mb-2" onclick="exportData()">
                                                    <i class="fas fa-download me-2"></i>Xuất dữ liệu
                                                </button>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-info w-100 mb-2" onclick="importData()">
                                                    <i class="fas fa-upload me-2"></i>Nhập dữ liệu
                                                </button>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-warning w-100 mb-2" onclick="backupData()">
                                                    <i class="fas fa-shield-alt me-2"></i>Sao lưu
                                                </button>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-danger w-100 mb-2" onclick="clearData()">
                                                    <i class="fas fa-trash me-2"></i>Xóa dữ liệu
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                Dữ liệu được lưu trữ cục bộ trên trình duyệt. Hãy thường xuyên sao lưu để tránh mất dữ liệu.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Thêm -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" id="addForm">
          <div class="modal-header">
            <h5 class="modal-title" id="addModalLabel">Thêm chuyên viên pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="addName" class="form-label">Họ tên</label>
              <input type="text" class="form-control" id="addName" required>
            </div>
            <div class="mb-3">
              <label for="addPosition" class="form-label">Chức vụ</label>
              <select class="form-control" id="addPosition" required>
                <option value="">Chọn chức vụ</option>
                <option value="Trưởng phòng Pháp chế">Trưởng phòng Pháp chế</option>
                <option value="Chuyên viên Pháp lý cấp cao">Chuyên viên Pháp lý cấp cao</option>
                <option value="Chuyên viên Pháp lý">Chuyên viên Pháp lý</option>
                <option value="Chuyên viên Tuân thủ">Chuyên viên Tuân thủ</option>
                <option value="Luật sư tư vấn">Luật sư tư vấn</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="addSpecialty" class="form-label">Chuyên môn</label>
              <select class="form-control" id="addSpecialty" required>
                <option value="">Chọn chuyên môn</option>
                <option value="Luật Doanh nghiệp">Luật Doanh nghiệp</option>
                <option value="Luật Lao động">Luật Lao động</option>
                <option value="Luật Bảo vệ người tiêu dùng">Luật Bảo vệ người tiêu dùng</option>
                <option value="Luật Thuế">Luật Thuế</option>
                <option value="Luật Du lịch">Luật Du lịch</option>
                <option value="Luật Bất động sản">Luật Bất động sản</option>
                <option value="Bảo mật dữ liệu">Bảo mật dữ liệu</option>
                <option value="Tuân thủ quốc tế">Tuân thủ quốc tế</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="addEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="addEmail" required>
            </div>
            <div class="mb-3">
              <label for="addPhone" class="form-label">Điện thoại</label>
              <input type="text" class="form-control" id="addPhone" required>
            </div>
            <div class="mb-3">
              <label for="addLicenseNumber" class="form-label">Số thẻ luật sư/Chứng chỉ</label>
              <input type="text" class="form-control" id="addLicenseNumber">
            </div>
            <div class="mb-3">
              <label for="addExperience" class="form-label">Kinh nghiệm (năm)</label>
              <input type="number" class="form-control" id="addExperience" min="0">
            </div>
            <div class="mb-3">
              <label for="addStatus" class="form-label">Trạng thái</label>
              <select class="form-control" id="addStatus" required>
                <option value="Đang làm việc">Đang làm việc</option>
                <option value="Tạm nghỉ">Tạm nghỉ</option>
                <option value="Nghỉ phép">Nghỉ phép</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Thêm</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Sửa -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" id="editForm">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">Sửa chuyên viên pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editId">
            <div class="mb-3">
              <label for="editName" class="form-label">Họ tên</label>
              <input type="text" class="form-control" id="editName" required>
            </div>
            <div class="mb-3">
              <label for="editPosition" class="form-label">Chức vụ</label>
              <select class="form-control" id="editPosition" required>
                <option value="">Chọn chức vụ</option>
                <option value="Trưởng phòng Pháp chế">Trưởng phòng Pháp chế</option>
                <option value="Chuyên viên Pháp lý cấp cao">Chuyên viên Pháp lý cấp cao</option>
                <option value="Chuyên viên Pháp lý">Chuyên viên Pháp lý</option>
                <option value="Chuyên viên Tuân thủ">Chuyên viên Tuân thủ</option>
                <option value="Luật sư tư vấn">Luật sư tư vấn</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editSpecialty" class="form-label">Chuyên môn</label>
              <select class="form-control" id="editSpecialty" required>
                <option value="">Chọn chuyên môn</option>
                <option value="Luật Doanh nghiệp">Luật Doanh nghiệp</option>
                <option value="Luật Lao động">Luật Lao động</option>
                <option value="Luật Bảo vệ người tiêu dùng">Luật Bảo vệ người tiêu dùng</option>
                <option value="Luật Thuế">Luật Thuế</option>
                <option value="Luật Du lịch">Luật Du lịch</option>
                <option value="Luật Bất động sản">Luật Bất động sản</option>
                <option value="Bảo mật dữ liệu">Bảo mật dữ liệu</option>
                <option value="Tuân thủ quốc tế">Tuân thủ quốc tế</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editEmail" required>
            </div>
            <div class="mb-3">
              <label for="editPhone" class="form-label">Điện thoại</label>
              <input type="text" class="form-control" id="editPhone" required>
            </div>
            <div class="mb-3">
              <label for="editLicenseNumber" class="form-label">Số thẻ luật sư/Chứng chỉ</label>
              <input type="text" class="form-control" id="editLicenseNumber">
            </div>
            <div class="mb-3">
              <label for="editExperience" class="form-label">Kinh nghiệm (năm)</label>
              <input type="number" class="form-control" id="editExperience" min="0">
            </div>
            <div class="mb-3">
              <label for="editStatus" class="form-label">Trạng thái</label>
              <select class="form-control" id="editStatus" required>
                <option value="Đang làm việc">Đang làm việc</option>
                <option value="Tạm nghỉ">Tạm nghỉ</option>
                <option value="Nghỉ phép">Nghỉ phép</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Lưu</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Modal Xem chi tiết -->
    <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="viewModalLabel">Thông tin chi tiết chuyên viên pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body" id="viewModalBody">
            <!-- Thông tin sẽ được load bằng JS -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Quản lý nhiệm vụ pháp lý -->
    <div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="taskModalLabel">Quản lý nhiệm vụ pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <button class="btn btn-primary" onclick="addTask()"><i class="fas fa-plus"></i> Thêm nhiệm vụ</button>
            </div>
            <table class="table table-dark table-hover">
              <thead>
                <tr>
                  <th>Nhiệm vụ</th>
                  <th>Ưu tiên</th>
                  <th>Hạn chót</th>
                  <th>Trạng thái</th>
                  <th>Thao tác</th>
                </tr>
              </thead>
              <tbody id="taskTableBody">
                <!-- Dữ liệu nhiệm vụ -->
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Thêm nhiệm vụ -->
    <div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" id="addTaskForm">
          <div class="modal-header">
            <h5 class="modal-title" id="addTaskModalLabel">Thêm nhiệm vụ pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="taskTitle" class="form-label">Tiêu đề nhiệm vụ</label>
              <input type="text" class="form-control" id="taskTitle" required>
            </div>
            <div class="mb-3">
              <label for="taskType" class="form-label">Loại công việc</label>
              <select class="form-control" id="taskType" required>
                <option value="">Chọn loại công việc</option>
                <option value="Soạn thảo hợp đồng">Soạn thảo hợp đồng</option>
                <option value="Rà soát quy định">Rà soát quy định</option>
                <option value="Tư vấn pháp lý">Tư vấn pháp lý</option>
                <option value="Giải quyết tranh chấp">Giải quyết tranh chấp</option>
                <option value="Đào tạo pháp luật">Đào tạo pháp luật</option>
                <option value="Kiểm tra tuân thủ">Kiểm tra tuân thủ</option>
                <option value="Báo cáo pháp lý">Báo cáo pháp lý</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="taskPriority" class="form-label">Mức độ ưu tiên</label>
              <select class="form-control" id="taskPriority" required>
                <option value="Thấp">Thấp</option>
                <option value="Trung bình">Trung bình</option>
                <option value="Cao">Cao</option>
                <option value="Khẩn cấp">Khẩn cấp</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="taskDeadline" class="form-label">Hạn chót</label>
              <input type="date" class="form-control" id="taskDeadline" required>
            </div>
            <div class="mb-3">
              <label for="taskDescription" class="form-label">Mô tả công việc</label>
              <textarea class="form-control" id="taskDescription" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Thêm</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Báo cáo -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reportModalLabel">Báo cáo thống kê</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <canvas id="positionChart" width="400" height="300"></canvas>
              </div>
              <div class="col-md-6">
                <canvas id="taskChart" width="400" height="300"></canvas>
              </div>
            </div>
            <div class="mt-4">
              <h6>Báo cáo chi tiết:</h6>
              <div id="detailReport"></div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="exportReport()">Xuất PDF</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Quản lý hồ sơ pháp lý -->
    <div class="modal fade" id="fileManagerModal" tabindex="-1" aria-labelledby="fileManagerModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="fileManagerModalLabel">Quản lý hồ sơ pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h6>Loại hồ sơ</h6>
                  </div>
                  <div class="card-body">
                    <div class="list-group">
                      <a href="#" class="list-group-item list-group-item-action active" onclick="showFileCategory('contract')">
                        <i class="fas fa-file-contract me-2"></i> Hợp đồng
                      </a>
                      <a href="#" class="list-group-item list-group-item-action" onclick="showFileCategory('regulation')">
                        <i class="fas fa-file-alt me-2"></i> Quy định
                      </a>
                      <a href="#" class="list-group-item list-group-item-action" onclick="showFileCategory('dispute')">
                        <i class="fas fa-gavel me-2"></i> Tranh chấp
                      </a>
                      <a href="#" class="list-group-item list-group-item-action" onclick="showFileCategory('compliance')">
                        <i class="fas fa-check-circle me-2"></i> Tuân thủ
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-8">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 id="fileCategoryTitle">Hợp đồng</h6>
                  <button class="btn btn-success btn-sm" onclick="addNewFile()"><i class="fas fa-plus"></i> Thêm hồ sơ</button>
                </div>
                <table class="table table-dark table-hover table-sm">
                  <thead>
                    <tr>
                      <th>Tên hồ sơ</th>
                      <th>Ngày tạo</th>
                      <th>Trạng thái</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody id="fileTableBody">
                    <!-- Dữ liệu hồ sơ -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Thêm hồ sơ -->
    <div class="modal fade" id="addFileModal" tabindex="-1" aria-labelledby="addFileModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" id="addFileForm">
          <div class="modal-header">
            <h5 class="modal-title" id="addFileModalLabel">Thêm hồ sơ pháp lý</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="fileName" class="form-label">Tên hồ sơ</label>
              <input type="text" class="form-control" id="fileName" required>
            </div>
            <div class="mb-3">
              <label for="fileCategory" class="form-label">Loại hồ sơ</label>
              <select class="form-control" id="fileCategory" required>
                <option value="contract">Hợp đồng</option>
                <option value="regulation">Quy định</option>
                <option value="dispute">Tranh chấp</option>
                <option value="compliance">Tuân thủ</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="fileDescription" class="form-label">Mô tả</label>
              <textarea class="form-control" id="fileDescription" rows="3"></textarea>
            </div>
            <div class="mb-3">
              <label for="fileStatus" class="form-label">Trạng thái</label>
              <select class="form-control" id="fileStatus" required>
                <option value="Đang xử lý">Đang xử lý</option>
                <option value="Hoàn thành">Hoàn thành</option>
                <option value="Tạm dừng">Tạm dừng</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Thêm</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Quản lý hiển thị section
        window.showSection = function(sectionName) {
            // Ẩn tất cả sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Hiển thị section được chọn
            document.getElementById(sectionName + 'Section').style.display = 'block';
            
            // Cập nhật active state cho menu
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            // Cập nhật tiêu đề header
            const titles = {
                'role': 'Chuyên viên pháp lý',
                'hr': 'Quản lý nhân sự',
                'settings': 'Cài đặt hệ thống'
            };
            document.querySelector('.main-header h1').textContent = titles[sectionName];
            
            // Load dữ liệu theo section
            if (sectionName === 'hr') {
                updateHRDashboard();
                loadLeaveCalendar();
            }
        };

        // Cập nhật dashboard HR
        function updateHRDashboard() {
            const officers = getOfficers();
            const currentMonth = new Date().getMonth();
            
            document.getElementById('hrTotalEmployees').textContent = officers.length;
            document.getElementById('hrActiveEmployees').textContent = officers.filter(o => o.status === 'Đang làm việc').length;
            document.getElementById('hrOnLeave').textContent = officers.filter(o => o.status === 'Nghỉ phép').length;
            document.getElementById('hrNewThisMonth').textContent = officers.filter(o => 
                o.createdAt && new Date(o.createdAt).getMonth() === currentMonth
            ).length;
        }

        // Load lịch nghỉ phép
        function loadLeaveCalendar() {
            const leaveData = [
                { name: 'Nguyễn Văn A', dates: '15-20/8', type: 'Nghỉ phép' },
                { name: 'Trần Thị B', dates: '22-24/8', type: 'Nghỉ ốm' },
                { name: 'Lê Văn C', dates: '28-30/8', type: 'Nghỉ phép' }
            ];
            
            document.getElementById('leaveCalendar').innerHTML = `
                <div class="list-group list-group-flush">
                    ${leaveData.map(leave => `
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${leave.name}</strong><br>
                                <small class="text-muted">${leave.dates}</small>
                            </div>
                            <span class="badge bg-${leave.type === 'Nghỉ phép' ? 'primary' : 'warning'}">${leave.type}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Các chức năng HR
        window.showRecruitment = function() {
            alert('Chức năng tuyển dụng: Quản lý quy trình tuyển dụng, đăng tin tuyển dụng, sàng lọc hồ sơ ứng viên, lên lịch phỏng vấn');
        };

        window.showTimesheet = function() {
            alert('Chức năng chấm công: Theo dõi giờ làm việc, quản lý ca làm việc, tính toán giờ tăng ca, báo cáo chấm công');
        };

        window.manageLeave = function() {
            alert('Quản lý nghỉ phép: Duyệt đơn nghỉ phép, theo dõi số ngày phép còn lại, lập lịch nghỉ phép, báo cáo nghỉ phép');
        };

        window.manageTraining = function() {
            alert('Quản lý đào tạo: Lên kế hoạch đào tạo, đăng ký khóa học, theo dõi tiến độ học tập, đánh giá hiệu quả đào tạo');
        };

        window.managePerformance = function() {
            alert('Quản lý KPI: Thiết lập mục tiêu KPI, đánh giá hiệu suất định kỳ, phản hồi 360 độ, kế hoạch phát triển cá nhân');
        };

        window.manageSalary = function() {
            alert('Quản lý lương: Tính toán lương, quản lý phụ cấp, xử lý thuế TNCN, báo cáo bảng lương, quản lý phúc lợi');
        };

        // Các chức năng Settings
        window.changePassword = function() {
            const newPassword = prompt('Nhập mật khẩu mới:');
            if (newPassword && newPassword.length >= 6) {
                alert('Đổi mật khẩu thành công!');
            } else if (newPassword) {
                alert('Mật khẩu phải có ít nhất 6 ký tự!');
            }
        };

        window.exportData = function() {
            const officers = getOfficers();
            const tasks = getTasks();
            const files = getFiles();
            
            const data = {
                officers: officers,
                tasks: tasks,
                files: files,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `compliance-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Dữ liệu đã được xuất thành công!');
        };

        window.importData = function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.officers) setOfficers(data.officers);
                            if (data.tasks) setTasks(data.tasks);
                            if (data.files) setFiles(data.files);
                            alert('Nhập dữ liệu thành công!');
                            renderTable();
                        } catch (error) {
                            alert('Lỗi: File không đúng định dạng!');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        };

        window.backupData = function() {
            const officers = getOfficers();
            const tasks = getTasks();
            const files = getFiles();
            
            localStorage.setItem('backup_officers_' + Date.now(), JSON.stringify(officers));
            localStorage.setItem('backup_tasks_' + Date.now(), JSON.stringify(tasks));
            localStorage.setItem('backup_files_' + Date.now(), JSON.stringify(files));
            
            alert('Dữ liệu đã được sao lưu thành công!');
        };

        window.clearData = function() {
            if (confirm('CẢNH BÁO: Bạn có chắc muốn xóa tất cả dữ liệu? Hành động này không thể hoàn tác!')) {
                if (confirm('Xác nhận lần cuối: Tất cả dữ liệu sẽ bị xóa vĩnh viễn!')) {
                    localStorage.removeItem('officers');
                    localStorage.removeItem('legalTasks');
                    localStorage.removeItem('legalFiles');
                    alert('Đã xóa tất cả dữ liệu!');
                    location.reload();
                }
            }
        };

        // Form settings
        document.getElementById('accountSettingsForm').onsubmit = function(e) {
            e.preventDefault();
            const displayName = document.getElementById('displayName').value;
            const userEmail = document.getElementById('userEmail').value;
            
            localStorage.setItem('userSettings', JSON.stringify({
                displayName: displayName,
                email: userEmail
            }));
            
            alert('Cài đặt tài khoản đã được lưu!');
        };

        // Load settings khi khởi tạo
        document.addEventListener('DOMContentLoaded', function() {
            const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');
            if (settings.displayName) {
                document.getElementById('displayName').value = settings.displayName;
            }
            if (settings.email) {
                document.getElementById('userEmail').value = settings.email;
            }
        });

        // Hàm lấy danh sách officer từ localStorage
        function getOfficers() {
            return JSON.parse(localStorage.getItem('officers') || '[]');
        }
        // Hàm lưu danh sách officer vào localStorage
        function setOfficers(data) {
            localStorage.setItem('officers', JSON.stringify(data));
        }
        // Hàm lấy danh sách nhiệm vụ từ localStorage
        function getTasks() {
            return JSON.parse(localStorage.getItem('legalTasks') || '[]');
        }
        // Hàm lưu danh sách nhiệm vụ vào localStorage
        function setTasks(data) {
            localStorage.setItem('legalTasks', JSON.stringify(data));
        }
        // Hàm lấy danh sách hồ sơ từ localStorage
        function getFiles() {
            return JSON.parse(localStorage.getItem('legalFiles') || '[]');
        }
        // Hàm lưu danh sách hồ sơ vào localStorage
        function setFiles(data) {
            localStorage.setItem('legalFiles', JSON.stringify(data));
        }

        // Cập nhật dashboard thống kê
        function updateDashboard() {
            const officers = getOfficers();
            const tasks = getTasks();
            const currentMonth = new Date().getMonth();
            
            document.getElementById('totalOfficers').textContent = officers.length;
            document.getElementById('activeTasks').textContent = tasks.filter(t => t.status === 'Đang thực hiện').length;
            document.getElementById('urgentTasks').textContent = tasks.filter(t => t.priority === 'Khẩn cấp').length;
            document.getElementById('completedTasks').textContent = tasks.filter(t => 
                t.status === 'Hoàn thành' && new Date(t.createdAt).getMonth() === currentMonth
            ).length;
        }

        // Render bảng với tìm kiếm và lọc
        function renderTable() {
            const officers = getOfficers();
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const positionFilter = document.getElementById('filterPosition')?.value || '';
            const statusFilter = document.getElementById('filterStatus')?.value || '';

            let filteredOfficers = officers.filter(o => {
                const matchSearch = o.name.toLowerCase().includes(searchTerm) || 
                                  o.email.toLowerCase().includes(searchTerm) ||
                                  (o.position && o.position.toLowerCase().includes(searchTerm));
                const matchPosition = !positionFilter || o.position === positionFilter;
                const matchStatus = !statusFilter || o.status === statusFilter;
                return matchSearch && matchPosition && matchStatus;
            });

            const tbody = document.querySelector('#officerTable tbody');
            tbody.innerHTML = filteredOfficers.map((o, i) => {
                const originalIndex = officers.indexOf(o);
                return `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${o.name}</td>
                        <td>${o.position || 'Chưa cập nhật'}</td>
                        <td>${o.specialty || 'Chưa cập nhật'}</td>
                        <td>${o.email}</td>
                        <td>${o.phone}</td>
                        <td><span class="badge bg-${o.status === 'Đang làm việc' ? 'success' : o.status === 'Nghỉ phép' ? 'warning' : 'secondary'}">${o.status || 'Đang làm việc'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-info me-1" onclick="viewOfficer(${originalIndex})" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-sm btn-warning me-1" onclick="manageTasks(${originalIndex})" title="Quản lý nhiệm vụ"><i class="fas fa-tasks"></i></button>
                            <button class="btn btn-sm btn-primary me-1" onclick="editOfficer(${originalIndex})" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="deleteOfficer(${originalIndex})" title="Xóa"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
            updateDashboard();
        }

        // Tìm kiếm và lọc
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput')?.addEventListener('input', renderTable);
            document.getElementById('filterPosition')?.addEventListener('change', renderTable);
            document.getElementById('filterStatus')?.addEventListener('change', renderTable);
        });

        // Xóa bộ lọc
        window.clearFilters = function() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterPosition').value = '';
            document.getElementById('filterStatus').value = '';
            renderTable();
        };

        // Tạo báo cáo
        window.generateReport = function() {
            const officers = getOfficers();
            const tasks = getTasks();
            
            // Thống kê theo chức vụ
            const positionStats = {};
            officers.forEach(o => {
                const pos = o.position || 'Chưa cập nhật';
                positionStats[pos] = (positionStats[pos] || 0) + 1;
            });

            // Thống kê nhiệm vụ
            const taskStats = {
                'Chưa bắt đầu': tasks.filter(t => !t.status || t.status === 'Chưa bắt đầu').length,
                'Đang thực hiện': tasks.filter(t => t.status === 'Đang thực hiện').length,
                'Hoàn thành': tasks.filter(t => t.status === 'Hoàn thành').length
            };

            // Hiển thị báo cáo chi tiết
            document.getElementById('detailReport').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>Thống kê theo chức vụ:</h6>
                        ${Object.entries(positionStats).map(([pos, count]) => 
                            `<p>${pos}: <strong>${count}</strong> người</p>`
                        ).join('')}
                    </div>
                    <div class="col-md-6">
                        <h6>Thống kê nhiệm vụ:</h6>
                        ${Object.entries(taskStats).map(([status, count]) => 
                            `<p>${status}: <strong>${count}</strong> nhiệm vụ</p>`
                        ).join('')}
                    </div>
                </div>
            `;

            bootstrap.Modal.getOrCreateInstance(document.getElementById('reportModal')).show();
        };

        // Xuất báo cáo PDF
        window.exportReport = function() {
            alert('Chức năng xuất PDF sẽ được tích hợp với thư viện jsPDF');
        };

        // Quản lý hồ sơ pháp lý
        window.showFileManager = function() {
            window.currentFileCategory = 'contract';
            renderFileTable('contract');
            bootstrap.Modal.getOrCreateInstance(document.getElementById('fileManagerModal')).show();
        };

        // Hiển thị loại hồ sơ
        window.showFileCategory = function(category) {
            window.currentFileCategory = category;
            const categoryTitles = {
                'contract': 'Hợp đồng',
                'regulation': 'Quy định', 
                'dispute': 'Tranh chấp',
                'compliance': 'Tuân thủ'
            };
            document.getElementById('fileCategoryTitle').textContent = categoryTitles[category];
            renderFileTable(category);
            
            // Cập nhật active state
            document.querySelectorAll('.list-group-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
        };

        // Render bảng hồ sơ
        function renderFileTable(category) {
            const files = getFiles().filter(f => f.category === category);
            const tbody = document.getElementById('fileTableBody');
            tbody.innerHTML = files.map((f, i) => `
                <tr>
                    <td>${f.name}</td>
                    <td>${new Date(f.createdAt).toLocaleDateString('vi-VN')}</td>
                    <td><span class="badge bg-${f.status === 'Hoàn thành' ? 'success' : f.status === 'Đang xử lý' ? 'primary' : 'warning'}">${f.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info me-1" onclick="viewFile(${f.id})" title="Xem"><i class="fas fa-eye"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteFile(${f.id})" title="Xóa"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        // Thêm hồ sơ mới
        window.addNewFile = function() {
            document.getElementById('fileCategory').value = window.currentFileCategory;
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addFileModal')).show();
        };

        document.getElementById('addFileForm').onsubmit = function(e) {
            e.preventDefault();
            const name = document.getElementById('fileName').value.trim();
            const category = document.getElementById('fileCategory').value;
            const description = document.getElementById('fileDescription').value.trim();
            const status = document.getElementById('fileStatus').value;
            
            if (!name || !category || !status) return;
            
            const files = getFiles();
            const newFile = {
                id: Date.now(),
                name, category, description, status,
                createdAt: new Date().toISOString()
            };
            files.push(newFile);
            setFiles(files);
            renderFileTable(window.currentFileCategory);
            this.reset();
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addFileModal')).hide();
        };

        // Xem hồ sơ
        window.viewFile = function(fileId) {
            const file = getFiles().find(f => f.id === fileId);
            if (file) {
                alert(`Hồ sơ: ${file.name}\nMô tả: ${file.description || 'Không có'}\nTrạng thái: ${file.status}`);
            }
        };

        // Xóa hồ sơ
        window.deleteFile = function(fileId) {
            if (confirm('Bạn có chắc muốn xóa hồ sơ này?')) {
                const files = getFiles();
                const updatedFiles = files.filter(f => f.id !== fileId);
                setFiles(updatedFiles);
                renderFileTable(window.currentFileCategory);
            }
        };

        // Thêm officer
        document.getElementById('addForm').onsubmit = function(e) {
            e.preventDefault();
            const name = document.getElementById('addName').value.trim();
            const position = document.getElementById('addPosition').value;
            const specialty = document.getElementById('addSpecialty').value;
            const email = document.getElementById('addEmail').value.trim();
            const phone = document.getElementById('addPhone').value.trim();
            const licenseNumber = document.getElementById('addLicenseNumber').value.trim();
            const experience = document.getElementById('addExperience').value;
            const status = document.getElementById('addStatus').value;
            
            if (!name || !position || !specialty || !email || !phone || !status) return;
            
            const officers = getOfficers();
            officers.push({ 
                name, position, specialty, email, phone, 
                licenseNumber, experience, status,
                createdAt: new Date().toISOString()
            });
            setOfficers(officers);
            renderTable();
            this.reset();
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addModal')).hide();
        };
        // Xem chi tiết officer
        window.viewOfficer = function(idx) {
            const officers = getOfficers();
            const o = officers[idx];
            const modalBody = document.getElementById('viewModalBody');
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-user me-2"></i>Thông tin cá nhân</h6>
                        <p><strong>Họ tên:</strong> ${o.name}</p>
                        <p><strong>Chức vụ:</strong> ${o.position || 'Chưa cập nhật'}</p>
                        <p><strong>Chuyên môn:</strong> ${o.specialty || 'Chưa cập nhật'}</p>
                        <p><strong>Email:</strong> ${o.email}</p>
                        <p><strong>Điện thoại:</strong> ${o.phone}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-certificate me-2"></i>Thông tin nghề nghiệp</h6>
                        <p><strong>Số thẻ luật sư:</strong> ${o.licenseNumber || 'Chưa có'}</p>
                        <p><strong>Kinh nghiệm:</strong> ${o.experience || 0} năm</p>
                        <p><strong>Trạng thái:</strong> <span class="badge bg-${o.status === 'Đang làm việc' ? 'success' : o.status === 'Nghỉ phép' ? 'warning' : 'secondary'}">${o.status}</span></p>
                        <p><strong>Ngày tạo:</strong> ${o.createdAt ? new Date(o.createdAt).toLocaleDateString('vi-VN') : 'Chưa rõ'}</p>
                    </div>
                </div>
            `;
            bootstrap.Modal.getOrCreateInstance(document.getElementById('viewModal')).show();
        };
        // Quản lý nhiệm vụ
        window.manageTasks = function(idx) {
            window.currentOfficerIndex = idx;
            const officers = getOfficers();
            const officerName = officers[idx].name;
            document.getElementById('taskModalLabel').textContent = `Nhiệm vụ pháp lý - ${officerName}`;
            renderTaskTable(idx);
            bootstrap.Modal.getOrCreateInstance(document.getElementById('taskModal')).show();
        };
        // Render bảng nhiệm vụ
        function renderTaskTable(officerIdx) {
            const tasks = getTasks().filter(t => t.officerId === officerIdx);
            const tbody = document.getElementById('taskTableBody');
            tbody.innerHTML = tasks.map((t, i) => `
                <tr>
                    <td>${t.title}</td>
                    <td><span class="badge bg-${t.priority === 'Khẩn cấp' ? 'danger' : t.priority === 'Cao' ? 'warning' : t.priority === 'Trung bình' ? 'info' : 'secondary'}">${t.priority}</span></td>
                    <td>${new Date(t.deadline).toLocaleDateString('vi-VN')}</td>
                    <td><span class="badge bg-${t.status === 'Hoàn thành' ? 'success' : t.status === 'Đang thực hiện' ? 'primary' : 'secondary'}">${t.status || 'Chưa bắt đầu'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-success me-1" onclick="toggleTaskStatus(${t.id})" title="Đánh dấu hoàn thành"><i class="fas fa-check"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTask(${t.id})" title="Xóa"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }
        // Thêm nhiệm vụ
        window.addTask = function() {
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addTaskModal')).show();
        };
        document.getElementById('addTaskForm').onsubmit = function(e) {
            e.preventDefault();
            const title = document.getElementById('taskTitle').value.trim();
            const type = document.getElementById('taskType').value;
            const priority = document.getElementById('taskPriority').value;
            const deadline = document.getElementById('taskDeadline').value;
            const description = document.getElementById('taskDescription').value.trim();
            
            if (!title || !type || !priority || !deadline) return;
            
            const tasks = getTasks();
            const newTask = {
                id: Date.now(),
                officerId: window.currentOfficerIndex,
                title, type, priority, deadline, description,
                status: 'Chưa bắt đầu',
                createdAt: new Date().toISOString()
            };
            tasks.push(newTask);
            setTasks(tasks);
            renderTaskTable(window.currentOfficerIndex);
            this.reset();
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addTaskModal')).hide();
        };
        // Thay đổi trạng thái nhiệm vụ
        window.toggleTaskStatus = function(taskId) {
            const tasks = getTasks();
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = task.status === 'Hoàn thành' ? 'Chưa bắt đầu' : 'Hoàn thành';
                setTasks(tasks);
                renderTaskTable(window.currentOfficerIndex);
            }
        };
        // Xóa nhiệm vụ
        window.deleteTask = function(taskId) {
            if (confirm('Bạn có chắc muốn xóa nhiệm vụ này?')) {
                const tasks = getTasks();
                const updatedTasks = tasks.filter(t => t.id !== taskId);
                setTasks(updatedTasks);
                renderTaskTable(window.currentOfficerIndex);
            }
        };
        // Sửa officer
        window.editOfficer = function(idx) {
            const officers = getOfficers();
            const o = officers[idx];
            document.getElementById('editId').value = idx;
            document.getElementById('editName').value = o.name;
            document.getElementById('editPosition').value = o.position || '';
            document.getElementById('editSpecialty').value = o.specialty || '';
            document.getElementById('editEmail').value = o.email;
            document.getElementById('editPhone').value = o.phone;
            document.getElementById('editLicenseNumber').value = o.licenseNumber || '';
            document.getElementById('editExperience').value = o.experience || '';
            document.getElementById('editStatus').value = o.status || 'Đang làm việc';
            bootstrap.Modal.getOrCreateInstance(document.getElementById('editModal')).show();
        };
        document.getElementById('editForm').onsubmit = function(e) {
            e.preventDefault();
            const idx = document.getElementById('editId').value;
            const name = document.getElementById('editName').value.trim();
            const position = document.getElementById('editPosition').value;
            const specialty = document.getElementById('editSpecialty').value;
            const email = document.getElementById('editEmail').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const licenseNumber = document.getElementById('editLicenseNumber').value.trim();
            const experience = document.getElementById('editExperience').value;
            const status = document.getElementById('editStatus').value;
            
            if (!name || !position || !specialty || !email || !phone || !status) return;
            
            const officers = getOfficers();
            officers[idx] = { 
                ...officers[idx],
                name, position, specialty, email, phone, 
                licenseNumber, experience, status
            };
            setOfficers(officers);
            renderTable();
            bootstrap.Modal.getOrCreateInstance(document.getElementById('editModal')).hide();
        };
        // Xóa officer
        window.deleteOfficer = function(idx) {
            if (confirm('Bạn có chắc muốn xóa chuyên viên này? Tất cả nhiệm vụ liên quan cũng sẽ bị xóa.')) {
                const officers = getOfficers();
                officers.splice(idx, 1);
                setOfficers(officers);
                
                // Xóa các nhiệm vụ liên quan
                const tasks = getTasks();
                const updatedTasks = tasks.filter(t => t.officerId !== idx);
                // Cập nhật lại index cho các nhiệm vụ còn lại
                updatedTasks.forEach(t => {
                    if (t.officerId > idx) t.officerId--;
                });
                setTasks(updatedTasks);
                
                renderTable();
            }
        };
        // Khởi tạo bảng khi load
        renderTable();

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDuX4_RKARM7g0K3BvoZPS8ADxVgrYQKYc",
            authDomain: "websitedatphongkhachsan.firebaseapp.com",
            databaseURL: "https://websitedatphongkhachsan-default-rtdb.firebaseio.com",
            projectId: "websitedatphongkhachsan",
            storageBucket: "websitedatphongkhachsan.appspot.com",
            messagingSenderId: "732884739524",
            appId: "1:732884739524:web:a9c34746f5704a9c3eb091",
            measurementId: "G-RC61EXTZH7"
        };

        // Khởi tạo Firebase
        firebase.initializeApp(firebaseConfig);

        // Đăng xuất với Firebase Auth
        function logout() {
            if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                // Kiểm tra xem Firebase Auth có sẵn không
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    firebase.auth().signOut().then(() => {
                        console.log('Đăng xuất thành công');
                        window.location.href = '../auth.html';
                    }).catch((error) => {
                        console.error('Lỗi đăng xuất:', error);
                        // Vẫn chuyển trang nếu có lỗi
                        window.location.href = '../auth.html';
                    });
                } else {
                    // Fallback nếu Firebase không có
                    window.location.href = '../auth.html';
                }
            }
        }
    </script>
</body>
</html>
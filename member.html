<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxuryHavenTravel - ƒê·∫∑t Ph√≤ng Kh√°ch S·∫°n Tr·ª±c Tuy·∫øn</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Th√™m SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="css/member.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-flex">
                <!-- Logo -->
                <a class="navbar-brand" href="#">
                    <img src="images/LuxuryHavenTravel.png" alt="LuxuryHaven Logo">
                </a>
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="nav-search">
                    <div class="search-input-group">
                        <input type="text" placeholder="T√¨m ki·∫øm...">
                        <button type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="nav-right">
                    <ul class="nav-links" id="nav-links">
                        <li><a href="index.html" class="active">Trang ch·ªß</a></li>
                        <li><a href="hotel.html">Kh√°ch s·∫°n</a></li>

                        <li class="dropdown"><a href="tours.html">Tours</a></li>

                        <li class="dropdown"><a href="prioritize.html">∆Øu ƒë√£i</a></li>
                        <li class="dropdown"><a href="travel_guide.html">C·∫©m nang du l·ªãch</a></li>
                        <li class="dropdown"><a href="about_us.html">V·ªÅ ch√∫ng t√¥i</a></li>
                        <!-- <li class="dropdown"><a href="vuichoi.html">üåê</a></li> -->
                        <li>
                            <div class="d-flex align-items-center">
                                <div class="dropdown" id="user-dropdown" style="display:none;">
                                    <button class="btn btn-outline-primary dropdown-toggle" type="button"
                                        id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-user"></i> <span id="user-name"></span>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="userDropdown">
                                        <li><a class="dropdown-item" href="member.html"><i
                                                    class="fas fa-user-circle"></i> T√†i kho·∫£n</a></li>
                                        <li><a class="dropdown-item" href="#" id="logout-btn"><i
                                                    class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</a></li>
                                    </ul>
                                </div>
                                <a href="#" class="btn btn-outline-primary me-2" id="open-login-modal">
                                    <i class="fas fa-user"></i> ƒêƒÉng nh·∫≠p
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <div class="container" style="margin-top: 120px;">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <div class="avatar-wrapper mb-3">
                                    <img src="https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y"
                                        alt="Avatar" class="rounded-circle"
                                        style="width: 100px; height: 100px; object-fit: cover;"
                                        onerror="this.src='https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y'">
                                </div>
                                <h5 class="mb-1" id="sidebar-user-name">T√™n ng∆∞·ªùi d√πng</h5>
                                <p class="text-muted" id="sidebar-user-email">email@example.com</p>
                            </div>
                            <div class="list-group">
                                <a href="#profile" class="list-group-item list-group-item-action active"
                                    data-bs-toggle="list">
                                    <i class="fas fa-user me-2"></i> Th√¥ng tin c√° nh√¢n
                                </a>
                                <a href="#bookings" class="list-group-item list-group-item-action"
                                    data-bs-toggle="list">
                                    <i class="fas fa-calendar-alt me-2"></i> L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng
                                </a>
                                <a href="#favorites" class="list-group-item list-group-item-action"
                                    data-bs-toggle="list">
                                    <i class="fas fa-heart me-2"></i> Danh s√°ch y√™u th√≠ch
                                </a>
                                <a href="#reviews" class="list-group-item list-group-item-action" data-bs-toggle="list">
                                    <i class="fas fa-star me-2"></i> ƒê√°nh gi√° c·ªßa t√¥i
                                </a>
                                <a href="#settings" class="list-group-item list-group-item-action"
                                    data-bs-toggle="list">
                                    <i class="fas fa-cog me-2"></i> C√†i ƒë·∫∑t t√†i kho·∫£n
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9">
                    <div class="tab-content">
                        <!-- Profile Tab -->
                        <div class="tab-pane fade show active" id="profile">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Th√¥ng tin c√° nh√¢n</h4>
                                    <form id="profile-form">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">H·ªç v√† t√™n</label>
                                                <input type="text" class="form-control" id="profile-name">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="profile-email" readonly>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                                                <input type="tel" class="form-control" id="profile-phone">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ng√†y sinh</label>
                                                <input type="date" class="form-control" id="profile-birthday">
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label class="form-label">ƒê·ªãa ch·ªâ</label>
                                                <textarea class="form-control" id="profile-address" rows="2"></textarea>
                                            </div>
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Bookings Tab -->
                        <div class="tab-pane fade" id="bookings">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng kh√°ch s·∫°n</h4>
                                    <div class="table-responsive">
                                        <table class="table align-middle">
                                            <thead>
                                                <tr>
                                                    <th>Kh√°ch s·∫°n</th>
                                                    <th>Th√¥ng tin ph√≤ng</th>
                                                    <th>Th·ªùi gian</th>
                                                    <th>Th√¥ng tin kh√°ch</th>
                                                    <th>Tr·∫°ng th√°i</th>
                                                    <th>Thao t√°c</th>
                                                </tr>
                                            </thead>
                                            <tbody id="bookings-table-hotel">
                                                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">L·ªãch s·ª≠ ƒë·∫∑t tour</h4>
                                    <div class="table-responsive">
                                        <table class="table align-middle">
                                            <thead>
                                                <tr>
                                                    <th>T√™n tour</th>
                                                    <th>Ng√†y kh·ªüi h√†nh</th>
                                                    <th>S·ªë ng∆∞·ªùi</th>
                                                    <th>Kh√°ch</th>
                                                    <th>Ghi ch√∫</th>
                                                    <th>Thao t√°c</th>
                                                </tr>
                                            </thead>
                                            <tbody id="bookings-table-tour">
                                                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Favorites Tab -->
                        <div class="tab-pane fade" id="favorites">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Danh s√°ch y√™u th√≠ch</h4>
                                    <div class="row" id="favorites-list">
                                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reviews Tab -->
                        <div class="tab-pane fade" id="reviews">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">ƒê√°nh gi√° c·ªßa t√¥i</h4>
                                    <div id="reviews-list">
                                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Settings Tab -->
                        <div class="tab-pane fade" id="settings">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">C√†i ƒë·∫∑t t√†i kho·∫£n</h4>
                                    <form id="settings-form">
                                        <div class="mb-3">
                                            <label class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                                            <input type="password" class="form-control" id="current-password">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                                            <input type="password" class="form-control" id="new-password">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                            <input type="password" class="form-control" id="confirm-password">
                                        </div>
                                        <button type="submit" class="btn btn-primary">ƒê·ªïi m·∫≠t kh·∫©u</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- End Contact Section -->

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <h4>V·ªÅ LuxuryHaven</h4>
                    <ul>
                        <li><a href="footer\about.html">Gi·ªõi thi·ªáu</a></li>
                        <li><a href="footer\recruitment.html">Tuy·ªÉn d·ª•ng</a></li>
                        <li><a href="footer\news.html">Tin t·ª©c</a></li>
                        <li><a href="footer\contact.html">Li√™n h·ªá</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h4>H·ªó tr·ª£</h4>
                    <ul>
                        <li><a href="footer\help-center.html">Trung t√¢m tr·ª£ gi√∫p</a></li>
                        <li><a href="footer\privacy-policy.html">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                        <li><a href="footer\terms.html">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></li>
                        <li><a href="footer\cookie-policy.html">Ch√≠nh s√°ch cookie</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h4>ƒê·ªëi t√°c</h4>
                    <ul>
                        <li><a href="footer\partner.html">ƒêƒÉng k√Ω l√†m ƒë·ªëi t√°c</a></li>
                        <li><a href="footer\marketing.html">Ch∆∞∆°ng tr√¨nh ti·∫øp th·ªã</a></li>
                        <li><a href="footer\affiliate.html">Affiliate</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h4>Theo d√µi ch√∫ng t√¥i</h4>
                    <div class="social-links">
                        <a href="https://facebook.com/100083035936090"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 LuxuryHaven. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            </div>
        </div>
    </footer>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content"
            style="max-width: 400px; padding: 32px 28px 24px 28px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.18);">
            <span class="close" id="close-auth-modal" style="right: 18px; top: 12px; font-size: 32px;">&times;</span>

            <div id="auth-forms">
                <form id="login-form" class="auth-form" style="text-align:center;">
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="login-email" style="font-weight: 500;">Email</label>
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                            <input type="email" id="login-email" placeholder="e.g. elon@tesla.com" required />
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="login-password" style="font-weight: 500;">M·∫≠t kh·∫©u</label>
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="login-password" placeholder="e.g. ilovemangools123" required />
                        </div>
                    </div>
                    <button type="submit" class="btn-gradient">ƒêƒÉng nh·∫≠p</button>
                    <div class="login-links">
                        <a href="#" id="to-register">Kh√¥ng c√≥ t√†i kho·∫£n?</a>
                        <a href="#" id="to-forgot">Qu√™n m·∫≠t kh·∫©u?</a>
                    </div>
                </form>

                <form id="register-form" class="auth-form" style="display: none; text-align:center;">
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="register-username" style="font-weight: 500;">T√™n ng∆∞·ªùi d√πng</label>
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="register-username" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" required />
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="register-email" style="font-weight: 500;">Email</label>
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="register-email" placeholder="Nh·∫≠p email c·ªßa b·∫°n" required />
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="register-password" style="font-weight: 500;">M·∫≠t kh·∫©u</label>
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="register-password" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±" required />
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="register-confirm-password" style="font-weight: 500;">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="register-confirm-password" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u"
                                required />
                        </div>
                    </div>
                    <button type="submit" class="btn-gradient">ƒêƒÉng k√Ω</button>
                    <div class="login-links">
                        <a href="#" id="to-login">ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p</a>
                    </div>
                </form>

                <form id="forgot-form" class="auth-form" style="display: none; text-align:center;">
                    <div class="form-group" style="margin-bottom: 18px; text-align:left;">
                        <label for="forgot-email" style="font-weight: 500;">Email</label>
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="forgot-email" placeholder="Nh·∫≠p email c·ªßa b·∫°n" required />
                        </div>
                    </div>
                    <button type="submit" class="btn-gradient">G·ª≠i y√™u c·∫ßu ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u</button>
                    <div class="login-links">
                        <a href="#" id="back-to-login">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDuX4_RKARM7g0K3BvoZPS8ADxVgrYQKYc",
            authDomain: "websitedatphongkhachsan.firebaseapp.com",
            databaseURL: "https://websitedatphongkhachsan-default-rtdb.firebaseio.com",
            projectId: "websitedatphongkhachsan",
            storageBucket: "websitedatphongkhachsan.appspot.com",
            messagingSenderId: "732884739524",
            appId: "1:732884739524:web:a9c34746f5704a9c3eb091",
            measurementId: "G-RC61EXTZH7"
        };

        // Kh·ªüi t·∫°o Firebase
        firebase.initializeApp(firebaseConfig);

        // Theo d√µi tr·∫°ng th√°i ƒëƒÉng nh·∫≠p v√† c·∫≠p nh·∫≠t UI
        firebase.auth().onAuthStateChanged(function (user) {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            // C·∫≠p nh·∫≠t UI ƒëƒÉng nh·∫≠p
            updateUserUI(user);

            // L·∫•y v√† hi·ªÉn th·ªã d·ªØ li·ªáu
            loadUserData(user);
            loadBookings(user);
            loadFavorites(user);
            loadReviews(user);
        });

        // H√†m c·∫≠p nh·∫≠t UI ng∆∞·ªùi d√πng
        function updateUserUI(user) {
            const loginBtn = document.getElementById('open-login-modal');
            const userDropdown = document.getElementById('user-dropdown');
            const userName = document.getElementById('user-name');
            const sidebarName = document.getElementById('sidebar-user-name');
            const sidebarEmail = document.getElementById('sidebar-user-email');

            if (loginBtn) loginBtn.style.display = 'none';
            if (userDropdown) {
                userDropdown.style.display = 'block';
                if (userName) userName.textContent = user.displayName || user.email;
            }

            if (sidebarName) sidebarName.textContent = user.displayName || 'Ch∆∞a c·∫≠p nh·∫≠t';
            if (sidebarEmail) sidebarEmail.textContent = user.email;
        }

        // H√†m l·∫•y th√¥ng tin ng∆∞·ªùi d√πng
        function loadUserData(user) {
            const userRef = firebase.database().ref('users/' + user.uid);
            userRef.on('value', (snapshot) => {
                const userData = snapshot.val() || {};

                // C·∫≠p nh·∫≠t form th√¥ng tin c√° nh√¢n
                document.getElementById('profile-name').value = userData.name || user.displayName || '';
                document.getElementById('profile-email').value = user.email;
                document.getElementById('profile-phone').value = userData.phone || '';
                document.getElementById('profile-birthday').value = userData.birthday || '';
                document.getElementById('profile-address').value = userData.address || '';

                // C·∫≠p nh·∫≠t sidebar
                document.getElementById('sidebar-user-name').textContent = userData.name || user.displayName || 'Ch∆∞a c·∫≠p nh·∫≠t';
            });

            // X·ª≠ l√Ω form c·∫≠p nh·∫≠t th√¥ng tin
            document.getElementById('profile-form').addEventListener('submit', function (e) {
                e.preventDefault();
                updateProfile(user, userRef);
            });
        }

        // H√†m l·∫•y l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng
        function loadBookings(user) {
            const bookingsRef = firebase.database().ref('bookings');
            bookingsRef.orderByChild('email').equalTo(user.email).on('value', (snapshot) => {
                const hotelTable = document.getElementById('bookings-table-hotel');
                const tourTable = document.getElementById('bookings-table-tour');
                if (!hotelTable || !tourTable) return;
                hotelTable.innerHTML = '';
                tourTable.innerHTML = '';
                if (snapshot.exists()) {
                    let bookings = [];
                    snapshot.forEach((bookingSnapshot) => {
                        bookings.push({
                            id: bookingSnapshot.key,
                            ...bookingSnapshot.val()
                        });
                    });
                    // S·∫Øp x·∫øp theo th·ªùi gian t·∫°o m·ªõi nh·∫•t
                    bookings.sort((a, b) => b.createdAt - a.createdAt);
                    let hasHotel = false, hasTour = false;
                    bookings.forEach(booking => {
                        if (booking.type === 'tour') {
                            addTourBookingRow(booking, tourTable);
                            hasTour = true;
                        } else {
                            addBookingRow(booking, hotelTable);
                            hasHotel = true;
                        }
                    });
                    if (!hasHotel) hotelTable.innerHTML = '<tr><td colspan="6" class="text-center py-4">Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng kh√°ch s·∫°n</td></tr>';
                    if (!hasTour) tourTable.innerHTML = '<tr><td colspan="6" class="text-center py-4">Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t tour</td></tr>';
                } else {
                    hotelTable.innerHTML = '<tr><td colspan="6" class="text-center py-4">Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng kh√°ch s·∫°n</td></tr>';
                    tourTable.innerHTML = '<tr><td colspan="6" class="text-center py-4">Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t tour</td></tr>';
                }
            });
        }

        // H√†m th√™m h√†ng ƒë·∫∑t ph√≤ng v√†o b·∫£ng
        function addBookingRow(booking, table) {
            const row = document.createElement('tr');
            const bookingDate = new Date(booking.createdAt);
            const today = new Date();
            const checkInDate = new Date(booking.checkIn);

            // X√°c ƒë·ªãnh tr·∫°ng th√°i ƒë·∫∑t ph√≤ng
            let status = '';
            let statusClass = '';

            if (checkInDate < today) {
                status = 'ƒê√£ ho√†n th√†nh';
                statusClass = 'success';
            } else if (checkInDate > today) {
                status = 'S·∫Øp t·ªõi';
                statusClass = 'warning';
            } else {
                status = 'ƒêang di·ªÖn ra';
                statusClass = 'primary';
            }

            row.innerHTML = `
            <td>
                <div class="fw-semibold">${booking.hotelId}</div>
            </td>
            <td>
                <div class="mb-1">${booking.roomId}</div>
            </td>
            <td>
                <div class="mb-1">Check-in: ${formatDate(booking.checkIn)}</div>
                <div>Check-out: ${formatDate(booking.checkOut)}</div>
                <small class="text-muted">ƒê·∫∑t ng√†y: ${formatDateTime(booking.createdAt)}</small>
            </td>
            <td>
                <div class="mb-1">Kh√°ch: ${booking.guests} ng∆∞·ªùi</div>
                <div class="mb-1">T√™n: ${booking.name}</div>
                <div>SƒêT: ${booking.phone}</div>
            </td>
            <td>
                <span class="badge bg-${statusClass}">${status}</span>
            </td>
            <td>
                <button class="btn btn-sm btn-outline-primary" onclick="viewBookingDetails('${booking.id}')">
                    <i class="fas fa-info-circle me-1"></i> Chi ti·∫øt
                </button>
            </td>
        `;
            table.appendChild(row);
        }

        // H√†m h·ªó tr·ª£ format ng√†y th√°ng
        function formatDate(dateString) {
            const options = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('vi-VN', options);
        }

        function formatDateTime(timestamp) {
            const options = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(timestamp).toLocaleDateString('vi-VN', options);
        }

        // H√†m l·∫•y danh s√°ch y√™u th√≠ch
        function loadFavorites(user) {
            const favoritesRef = firebase.database().ref('favorites/' + user.uid);
            favoritesRef.on('value', (snapshot) => {
                const favoritesList = document.getElementById('favorites-list');
                if (!favoritesList) return;

                favoritesList.innerHTML = '';

                if (snapshot.exists()) {
                    snapshot.forEach((favoriteSnapshot) => {
                        const favorite = favoriteSnapshot.val();
                        addFavoriteItem(favorite, favoritesList);
                    });
                } else {
                    favoritesList.innerHTML = '<div class="col-12 text-center">Ch∆∞a c√≥ kh√°ch s·∫°n y√™u th√≠ch</div>';
                }
            });
        }

        // H√†m th√™m item y√™u th√≠ch
        function addFavoriteItem(favorite, container) {
            const col = document.createElement('div');
            col.className = 'col-md-4';
            col.innerHTML = `
            <div class="favorite-item">
                <img src="${favorite.image || 'https://via.placeholder.com/300x200?text=Hotel+Image'}" 
                     alt="${favorite.name}" 
                     onerror="this.src='https://via.placeholder.com/300x200?text=Hotel+Image'">
                <div class="overlay">
                    <h5>${favorite.name || 'Kh√¥ng c√≥ t√™n'}</h5>
                    <p>${favorite.location || 'Kh√¥ng c√≥ ƒë·ªãa ch·ªâ'}</p>
                </div>
            </div>
        `;
            container.appendChild(col);
        }

        // H√†m l·∫•y ƒë√°nh gi√°
        function loadReviews(user) {
            const reviewsRef = firebase.database().ref('reviews');
            reviewsRef.orderByChild('userId').equalTo(user.uid).on('value', (snapshot) => {
                const reviewsList = document.getElementById('reviews-list');
                if (!reviewsList) return;

                reviewsList.innerHTML = '';

                if (snapshot.exists()) {
                    snapshot.forEach((reviewSnapshot) => {
                        const review = reviewSnapshot.val();
                        addReviewItem(review, reviewsList);
                    });
                } else {
                    reviewsList.innerHTML = '<div class="text-center">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o</div>';
                }
            });
        }

        // H√†m th√™m item ƒë√°nh gi√°
        function addReviewItem(review, container) {
            const div = document.createElement('div');
            div.className = 'review-item';
            div.innerHTML = `
            <div class="rating">
                ${'‚òÖ'.repeat(review.rating || 0)}${'‚òÜ'.repeat(5 - (review.rating || 0))}
            </div>
            <h5>${review.hotelName || 'Kh√¥ng c√≥ t√™n kh√°ch s·∫°n'}</h5>
            <p>${review.comment || 'Kh√¥ng c√≥ n·ªôi dung'}</p>
            <span class="date">${new Date(review.date).toLocaleDateString('vi-VN')}</span>
        `;
            container.appendChild(div);
        }

        // H√†m c·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n
        function updateProfile(user, userRef) {
            const updates = {
                name: document.getElementById('profile-name').value,
                phone: document.getElementById('profile-phone').value,
                birthday: document.getElementById('profile-birthday').value,
                address: document.getElementById('profile-address').value,
                email: user.email,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            };

            Swal.fire({
                title: 'ƒêang c·∫≠p nh·∫≠t...',
                text: 'Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            user.updateProfile({
                displayName: updates.name
            }).then(() => {
                return userRef.update(updates);
            }).then(() => {
                Swal.fire({
                    title: 'Th√†nh c√¥ng!',
                    text: 'Th√¥ng tin c√° nh√¢n ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.',
                    icon: 'success',
                    confirmButtonColor: '#1a237e'
                });

                document.getElementById('sidebar-user-name').textContent = updates.name;
                document.getElementById('user-name').textContent = updates.name;
            }).catch((error) => {
                console.error('L·ªói c·∫≠p nh·∫≠t:', error);
                Swal.fire({
                    title: 'L·ªói!',
                    text: 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin. Vui l√≤ng th·ª≠ l·∫°i sau.',
                    icon: 'error',
                    confirmButtonColor: '#1a237e'
                });
            });
        }

        // H√†m xem chi ti·∫øt ƒë·∫∑t ph√≤ng
        function viewBookingDetails(bookingId) {
            const bookingRef = firebase.database().ref('bookings/' + bookingId);
            bookingRef.once('value').then((snapshot) => {
                const booking = snapshot.val();
                if (booking) {
                    Swal.fire({
                        title: 'Chi ti·∫øt ƒë·∫∑t ph√≤ng',
                        html: `
                        <div class="text-start">
                            <div class="mb-3">
                                <h5 class="mb-2">Th√¥ng tin kh√°ch s·∫°n</h5>
                                <p class="mb-1"><strong>Kh√°ch s·∫°n:</strong> ${booking.hotelId}</p>
                                <p class="mb-1"><strong>Lo·∫°i ph√≤ng:</strong> ${booking.roomId}</p>
                            </div>
                            <div class="mb-3">
                                <h5 class="mb-2">Th·ªùi gian</h5>
                                <p class="mb-1"><strong>Nh·∫≠n ph√≤ng:</strong> ${formatDate(booking.checkIn)}</p>
                                <p class="mb-1"><strong>Tr·∫£ ph√≤ng:</strong> ${formatDate(booking.checkOut)}</p>
                                <p class="mb-1"><strong>Ng√†y ƒë·∫∑t:</strong> ${formatDateTime(booking.createdAt)}</p>
                            </div>
                            <div class="mb-3">
                                <h5 class="mb-2">Th√¥ng tin kh√°ch h√†ng</h5>
                                <p class="mb-1"><strong>H·ªç t√™n:</strong> ${booking.name}</p>
                                <p class="mb-1"><strong>Email:</strong> ${booking.email}</p>
                                <p class="mb-1"><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${booking.phone}</p>
                                <p class="mb-1"><strong>S·ªë kh√°ch:</strong> ${booking.guests} ng∆∞·ªùi</p>
                            </div>
                        </div>
                    `,
                        confirmButtonColor: '#1a237e',
                        confirmButtonText: 'ƒê√≥ng',
                        customClass: {
                            container: 'booking-detail-modal'
                        }
                    });
                }
            });
        }

        // X·ª≠ l√Ω ƒëƒÉng xu·∫•t
        document.getElementById('logout-btn').addEventListener('click', function (e) {
            e.preventDefault();
            firebase.auth().signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('L·ªói ƒëƒÉng xu·∫•t:', error);
                Swal.fire({
                    title: 'L·ªói!',
                    text: 'Kh√¥ng th·ªÉ ƒëƒÉng xu·∫•t. Vui l√≤ng th·ª≠ l·∫°i sau.',
                    icon: 'error',
                    confirmButtonColor: '#1a237e'
                });
            });
        });

        function addTourBookingRow(booking, table) {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${booking.hotelId || booking.tourName || ''}</td>
            <td>${booking.checkIn || booking.date || ''}</td>
            <td>${booking.guests || booking.people || ''}</td>
            <td>${booking.name || ''}<br><span class="text-muted">${booking.phone || ''}</span></td>
            <td>${booking.note || ''}</td>
            <td>
                <button class="btn btn-sm btn-outline-primary" onclick="viewTourBookingDetails('${booking.id}')">
                    <i class="fas fa-info-circle me-1"></i> Chi ti·∫øt
                </button>
            </td>
        `;
            table.appendChild(row);
        }

        function viewTourBookingDetails(bookingId) {
            const bookingRef = firebase.database().ref('bookings/' + bookingId);
            bookingRef.once('value').then((snapshot) => {
                const booking = snapshot.val();
                if (booking) {
                    Swal.fire({
                        title: 'Chi ti·∫øt ƒë·∫∑t tour',
                        html: `
                        <div class="text-start">
                            <div class="mb-3">
                                <h5 class="mb-2">Th√¥ng tin tour</h5>
                                <p class="mb-1"><strong>T√™n tour:</strong> ${booking.hotelId || ''}</p>
                                <p class="mb-1"><strong>Ng√†y kh·ªüi h√†nh:</strong> ${booking.checkIn || ''}</p>
                                <p class="mb-1"><strong>S·ªë ng∆∞·ªùi:</strong> ${booking.guests || ''}</p>
                            </div>
                            <div class="mb-3">
                                <h5 class="mb-2">Th√¥ng tin kh√°ch h√†ng</h5>
                                <p class="mb-1"><strong>H·ªç t√™n:</strong> ${booking.name || ''}</p>
                                <p class="mb-1"><strong>Email:</strong> ${booking.email || ''}</p>
                                <p class="mb-1"><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${booking.phone || ''}</p>
                            </div>
                            <div class="mb-3">
                                <h5 class="mb-2">Ghi ch√∫</h5>
                                <p class="mb-1">${booking.note || ''}</p>
                            </div>
                        </div>
                    `,
                        confirmButtonColor: '#1a237e',
                        confirmButtonText: 'ƒê√≥ng',
                        customClass: {
                            container: 'booking-detail-modal'
                        }
                    });
                }
            });
        }

        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const navLinks = document.getElementById('nav-links');

        if (mobileMenuBtn && navLinks) {
            mobileMenuBtn.addEventListener('click', function () {
                this.classList.toggle('active');
                navLinks.classList.toggle('active');
            });

            // Close mobile menu when clicking on links
            navLinks.addEventListener('click', function (e) {
                if (e.target.tagName === 'A') {
                    mobileMenuBtn.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function (e) {
                if (!mobileMenuBtn.contains(e.target) && !navLinks.contains(e.target)) {
                    mobileMenuBtn.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        }
    </script>
</body>

</html>